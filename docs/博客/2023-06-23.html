<!doctype html><html lang="zh-CN"><head><meta charset="utf-8" /><meta name="viewport" content="width=device-width,initial-scale=1" /><meta name="generator" content="VuePress 2.0.0-rc.20" /><meta name="theme" content="VuePress Theme Plume " /><script id="check-mac-os">document.documentElement.classList.toggle('mac', /Mac|iPhone|iPod|iPad/i.test(navigator.platform))</script><script id="check-dark-mode">;(function () {const um= localStorage.getItem('vuepress-theme-appearance') || 'auto';const sm = window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches;const isDark = um === 'dark' || (um !== 'light' && sm);document.documentElement.dataset.theme = isDark ? 'dark' : 'light';})();</script><link rel="icon" type="image/png" href="/logo.png"><title>一次基于LXD的实验室GPU服务器环境配置及踩坑记录 | vuepress-yuany3721</title><meta name="description" content=""><link rel="preload" href="/assets/style-DqR8vyyo.css" as="style"><link rel="stylesheet" href="/assets/style-DqR8vyyo.css"><link rel="modulepreload" href="/assets/app-B5m6HLX-.js"><link rel="modulepreload" href="/assets/2023-06-23.html-B3A8vR_6.js"></head><body><div id="app"><!--[--><!--[--><div class="theme-plume vp-layout" vp-container data-v-68cd6b44><!--[--><!--[--><!--]--><!--[--><span tabindex="-1" data-v-d5a8d0bc></span><a href="#VPContent" class="vp-skip-link visually-hidden" data-v-d5a8d0bc> Skip to content </a><!--]--><!----><header class="vp-nav" data-v-68cd6b44 data-v-d34f28d6><div class="vp-navbar" vp-navbar data-v-d34f28d6 data-v-70d97d16><div class="wrapper" data-v-70d97d16><div class="container" data-v-70d97d16><div class="title" data-v-70d97d16><div class="vp-navbar-title" data-v-70d97d16 data-v-1a4f50af><a class="vp-link no-icon link title" href="/" data-v-1a4f50af data-v-442a52aa><!--[--><!--[--><!--]--><!--[--><!--[--><!--[--><img class="vp-image dark logo" style="" src="/logo.png" alt data-v-eda4b9bd><!--]--><!--[--><img class="vp-image light logo" style="" src="/logo.png" alt data-v-eda4b9bd><!--]--><!--]--><!--]--><span data-v-1a4f50af>vuepress-yuany3721</span><!--[--><!--]--><!--]--><!----></a></div></div><div class="content" data-v-70d97d16><div class="content-body" data-v-70d97d16><!--[--><!--]--><div class="vp-navbar-search search" data-v-70d97d16><div class="search-wrapper" data-v-97535d1e><!----><div id="local-search" data-v-97535d1e><button type="button" class="mini-search mini-search-button" aria-label="搜索文档" data-v-97535d1e><span class="mini-search-button-container"><span class="mini-search-search-icon vpi-mini-search" aria-label="search icon"></span><span class="mini-search-button-placeholder">搜索文档</span></span><span class="mini-search-button-keys"><kbd class="mini-search-button-key"></kbd><kbd class="mini-search-button-key">K</kbd></span></button></div></div></div><nav aria-labelledby="main-nav-aria-label" class="vp-navbar-menu menu" data-v-70d97d16 data-v-d43c1732><span id="main-nav-aria-label" class="visually-hidden" data-v-d43c1732>Main Navigation</span><!--[--><!--[--><a class="vp-link no-icon link navbar-menu-link" href="/blog/" tabindex="0" data-v-d43c1732 data-v-9970a379 data-v-442a52aa><!--[--><!----><span data-v-9970a379>主页</span><!--]--><!----></a><!--]--><!--[--><a class="vp-link no-icon link navbar-menu-link" href="/blog/archives/" tabindex="0" data-v-d43c1732 data-v-9970a379 data-v-442a52aa><!--[--><!----><span data-v-9970a379>归档</span><!--]--><!----></a><!--]--><!--[--><a class="vp-link no-icon link navbar-menu-link" href="/%E6%96%87%E6%A1%A3/" tabindex="0" data-v-d43c1732 data-v-9970a379 data-v-442a52aa><!--[--><!----><span data-v-9970a379>文档</span><!--]--><!----></a><!--]--><!--[--><div class="vp-flyout vp-navbar-menu-group" data-v-d43c1732 data-v-feafea4e><button type="button" class="button" aria-haspopup="true" aria-expanded="false" data-v-feafea4e><span class="text" data-v-feafea4e><!----><!----><span data-v-feafea4e>更新日志</span><span class="vpi-chevron-down text-icon" data-v-feafea4e></span></span></button><div class="menu" data-v-feafea4e><div class="vp-menu" data-v-feafea4e data-v-709dc2b1><div class="items" data-v-709dc2b1><!--[--><!--[--><div class="vp-menu-link" data-v-709dc2b1 data-v-aaf95230><a class="vp-link no-icon link" href="/%E6%9B%B4%E6%96%B0%E6%97%A5%E5%BF%97/Web/" data-v-aaf95230 data-v-442a52aa><!--[--><!----> Web<!--]--><!----></a></div><!--]--><!--[--><div class="vp-menu-link" data-v-709dc2b1 data-v-aaf95230><a class="vp-link no-icon link" href="/%E6%9B%B4%E6%96%B0%E6%97%A5%E5%BF%97/Bot/" data-v-aaf95230 data-v-442a52aa><!--[--><!----> Bot<!--]--><!----></a></div><!--]--><!--]--></div><!--[--><!--]--></div></div></div><!--]--><!--]--></nav><!----><div class="vp-navbar-appearance appearance" data-v-70d97d16 data-v-a295abf6><button class="vp-switch vp-switch-appearance" type="button" role="switch" title aria-checked="false" data-v-a295abf6 data-v-596c25a9 data-v-d84fedac><span class="check" data-v-d84fedac><span class="icon" data-v-d84fedac><!--[--><span class="vpi-sun sun" data-v-596c25a9></span><span class="vpi-moon moon" data-v-596c25a9></span><!--]--></span></span></button></div><!----><div class="vp-flyout vp-navbar-extra extra" data-v-70d97d16 data-v-652282fd data-v-feafea4e><button type="button" class="button" aria-haspopup="true" aria-expanded="false" aria-label="extra navigation" data-v-feafea4e><span class="vpi-more-horizontal icon" data-v-feafea4e></span></button><div class="menu" data-v-feafea4e><div class="vp-menu" data-v-feafea4e data-v-709dc2b1><!----><!--[--><!--[--><!----><div class="group" data-v-652282fd><div class="item appearance" data-v-652282fd><p class="label" data-v-652282fd>外观</p><div class="appearance-action" data-v-652282fd><button class="vp-switch vp-switch-appearance" type="button" role="switch" title aria-checked="false" data-v-652282fd data-v-596c25a9 data-v-d84fedac><span class="check" data-v-d84fedac><span class="icon" data-v-d84fedac><!--[--><span class="vpi-sun sun" data-v-596c25a9></span><span class="vpi-moon moon" data-v-596c25a9></span><!--]--></span></span></button></div></div></div><!----><!--]--><!--]--></div></div></div><!--[--><!--]--><button type="button" class="vp-navbar-hamburger hamburger" aria-label="mobile navigation" aria-expanded="false" aria-controls="nav-screen" data-v-70d97d16 data-v-2b50024d><span class="container" data-v-2b50024d><span class="top" data-v-2b50024d></span><span class="middle" data-v-2b50024d></span><span class="bottom" data-v-2b50024d></span></span></button></div></div></div></div><div class="divider" data-v-70d97d16><div class="divider-line" data-v-70d97d16></div></div></div><!----></header><div class="vp-local-nav fixed reached-top is-blog" data-v-68cd6b44 data-v-3944d8e8><button class="hidden menu" disabled aria-expanded="false" aria-controls="SidebarNav" data-v-3944d8e8><span class="vpi-align-left menu-icon" data-v-3944d8e8></span><span class="menu-text" data-v-3944d8e8>Menu</span></button><div class="vp-local-nav-outline-dropdown" style="--vp-vh:0px;" data-v-3944d8e8 data-v-423a73ec><button data-v-423a73ec>返回顶部</button><!----></div></div><!----><!--[--><div id="VPContent" vp-content class="vp-content" data-v-68cd6b44 data-v-eb709286><div class="vp-doc-container is-blog" data-v-eb709286 data-v-e91ad060><!--[--><!--]--><div class="container" data-v-e91ad060><!----><div class="content" data-v-e91ad060><div class="content-container" data-v-e91ad060><!--[--><!--]--><main class="main" data-v-e91ad060><nav class="vp-breadcrumb" data-v-e91ad060 data-v-1ae4ad7a><ol vocab="https://schema.org/" typeof="BreadcrumbList" data-v-1ae4ad7a><!--[--><li property="itemListElement" typeof="ListItem" data-v-1ae4ad7a><a class="vp-link no-icon link breadcrumb" href="/" property="item" typeof="WebPage" data-v-1ae4ad7a data-v-442a52aa><!--[-->首页<!--]--><!----></a><span class="vpi-chevron-right" data-v-1ae4ad7a></span><meta property="name" content="首页" data-v-1ae4ad7a><meta property="position" content="1" data-v-1ae4ad7a></li><li property="itemListElement" typeof="ListItem" data-v-1ae4ad7a><a class="vp-link no-icon link breadcrumb" href="/blog/" property="item" typeof="WebPage" data-v-1ae4ad7a data-v-442a52aa><!--[-->博客<!--]--><!----></a><span class="vpi-chevron-right" data-v-1ae4ad7a></span><meta property="name" content="博客" data-v-1ae4ad7a><meta property="position" content="2" data-v-1ae4ad7a></li><li property="itemListElement" typeof="ListItem" data-v-1ae4ad7a><a class="vp-link no-icon link breadcrumb" href="/blog/categories/?id=c50d13" property="item" typeof="WebPage" data-v-1ae4ad7a data-v-442a52aa><!--[-->博客<!--]--><!----></a><span class="vpi-chevron-right" data-v-1ae4ad7a></span><meta property="name" content="博客" data-v-1ae4ad7a><meta property="position" content="3" data-v-1ae4ad7a></li><li property="itemListElement" typeof="ListItem" data-v-1ae4ad7a><a class="vp-link no-icon link breadcrumb current" href="/%E5%8D%9A%E5%AE%A2/2023-06-23.html" property="item" typeof="WebPage" data-v-1ae4ad7a data-v-442a52aa><!--[-->一次基于LXD的实验室GPU服务器环境配置及踩坑记录<!--]--><!----></a><!----><meta property="name" content="一次基于LXD的实验室GPU服务器环境配置及踩坑记录" data-v-1ae4ad7a><meta property="position" content="4" data-v-1ae4ad7a></li><!--]--></ol></nav><!--[--><h1 class="vp-doc-title page-title" data-v-7e9208b4>一次基于LXD的实验室GPU服务器环境配置及踩坑记录 <!----></h1><div class="vp-doc-meta" data-v-7e9208b4><p class="reading-time" data-v-7e9208b4><span class="vpi-books icon" data-v-7e9208b4></span><span data-v-7e9208b4>约 4710 字</span><span data-v-7e9208b4>大约 16 分钟</span></p><p data-v-7e9208b4><span class="vpi-tag icon" data-v-7e9208b4></span><!--[--><a class="vp-link no-icon link tag vp-tag-5moe" href="/blog/tags/?tag=Ubuntu" data-v-7e9208b4 data-v-442a52aa><!--[-->Ubuntu<!--]--><!----></a><a class="vp-link no-icon link tag vp-tag-3rdx" href="/blog/tags/?tag=LXD" data-v-7e9208b4 data-v-442a52aa><!--[-->LXD<!--]--><!----></a><!--]--></p><p class="create-time" data-v-7e9208b4><span class="vpi-clock icon" data-v-7e9208b4></span><span data-v-7e9208b4>2023-07-17</span></p></div><!--]--><div class="_%E5%8D%9A%E5%AE%A2_2023-06-23 external-link-icon-enabled vp-doc plume-content" vp-content data-v-e91ad060><div data-v-e91ad060><nav class="table-of-contents"><ul><li><a aria-current="page" href="/%E5%8D%9A%E5%AE%A2/2023-06-23.html#前言" class="router-link-active router-link-exact-active">前言</a></li><li><a aria-current="page" href="/%E5%8D%9A%E5%AE%A2/2023-06-23.html#架构选择" class="router-link-active router-link-exact-active">架构选择</a></li><li><a aria-current="page" href="/%E5%8D%9A%E5%AE%A2/2023-06-23.html#环境说明及前置工作" class="router-link-active router-link-exact-active">环境说明及前置工作</a><ul><li><a aria-current="page" href="/%E5%8D%9A%E5%AE%A2/2023-06-23.html#环境说明" class="router-link-active router-link-exact-active">环境说明</a></li><li><a aria-current="page" href="/%E5%8D%9A%E5%AE%A2/2023-06-23.html#前置工作" class="router-link-active router-link-exact-active">前置工作</a></li></ul></li><li><a aria-current="page" href="/%E5%8D%9A%E5%AE%A2/2023-06-23.html#配置-lxd-gpu-环境" class="router-link-active router-link-exact-active">配置 LXD-GPU 环境</a><ul><li><a aria-current="page" href="/%E5%8D%9A%E5%AE%A2/2023-06-23.html#配置运行环境" class="router-link-active router-link-exact-active">配置运行环境</a></li><li><a aria-current="page" href="/%E5%8D%9A%E5%AE%A2/2023-06-23.html#配置基础镜像" class="router-link-active router-link-exact-active">配置基础镜像</a></li></ul></li><li><a aria-current="page" href="/%E5%8D%9A%E5%AE%A2/2023-06-23.html#管理员指北" class="router-link-active router-link-exact-active">管理员指北</a><ul><li><a aria-current="page" href="/%E5%8D%9A%E5%AE%A2/2023-06-23.html#如何访问宿主机" class="router-link-active router-link-exact-active">如何访问宿主机</a></li><li><a aria-current="page" href="/%E5%8D%9A%E5%AE%A2/2023-06-23.html#新建容器" class="router-link-active router-link-exact-active">新建容器</a></li><li><a aria-current="page" href="/%E5%8D%9A%E5%AE%A2/2023-06-23.html#删除容器" class="router-link-active router-link-exact-active">删除容器</a></li></ul></li><li><a aria-current="page" href="/%E5%8D%9A%E5%AE%A2/2023-06-23.html#用户指南" class="router-link-active router-link-exact-active">用户指南</a><ul><li><a aria-current="page" href="/%E5%8D%9A%E5%AE%A2/2023-06-23.html#联系管理员获取授权" class="router-link-active router-link-exact-active">联系管理员获取授权</a></li><li><a aria-current="page" href="/%E5%8D%9A%E5%AE%A2/2023-06-23.html#从命令行访问服务器并修改密码" class="router-link-active router-link-exact-active">从命令行访问服务器并修改密码</a></li><li><a aria-current="page" href="/%E5%8D%9A%E5%AE%A2/2023-06-23.html#通过-xrdp-登录图形界面" class="router-link-active router-link-exact-active">通过 xrdp 登录图形界面</a></li><li><a aria-current="page" href="/%E5%8D%9A%E5%AE%A2/2023-06-23.html#文件传输" class="router-link-active router-link-exact-active">文件传输</a></li><li><a aria-current="page" href="/%E5%8D%9A%E5%AE%A2/2023-06-23.html#其它服务器使用方式" class="router-link-active router-link-exact-active">其它服务器使用方式</a></li></ul></li><li><a aria-current="page" href="/%E5%8D%9A%E5%AE%A2/2023-06-23.html#参考资料" class="router-link-active router-link-exact-active">参考资料</a></li></ul></nav><h2 id="前言" tabindex="-1"><a class="header-anchor" href="#前言"><span>前言</span></a></h2><p>本文的受众为实验室的公用 GPU 服务器管理员，需要有一定的 Linux 基础，或者对此感兴趣的普通用户。</p><p>如果您并不关心为何这样配置服务器环境，以及对如何部署、管理这样一台服务器不感兴趣，可以选择跳过这些内容，前往<a class="route-link" href="/%E5%8D%9A%E5%AE%A2/2023-06-23.html#%E7%AE%A1%E7%90%86%E5%91%98%E6%8C%87%E5%8C%97">管理员指北</a>、<a class="route-link" href="/%E5%8D%9A%E5%AE%A2/2023-06-23.html#%E7%94%A8%E6%88%B7%E6%8C%87%E5%8D%97">用户指南</a>。</p><p>事情的起因是实验室购入了一台公用 GPU 服务器，考虑到每个人所需的软件和环境差异巨大，因此，需要一种方案来满足多用户对服务器的使用的需求。</p><p>这里列出一些期望达到的目标：</p><ul><li>不同用户之间不能相互影响</li><li>用户要能便捷地访问服务器</li><li>用户的操作不能影响到宿主机的稳定运行</li><li>用户应当可以自由地访问外部网络</li><li>用户应当可以使用 GPU，不同用户可以共享 GPU</li><li>用户应当可以自由地配置程序运行环境</li><li>管理员应该能轻松地管理用户</li></ul><p><strong>注意：</strong> <em>本次部署属于科研基础架构的部署，属于各种软件的工程实现和部署，本身并不具备科研价值，同样也无法基于该方法搭建的服务器实验运行结果、实验数据产出做出任何保障。</em></p><h2 id="架构选择" tabindex="-1"><a class="header-anchor" href="#架构选择"><span>架构选择</span></a></h2><p>从最初的需求出发，我们想要不同用户之间不能相互影响，也就是在用户级别进行隔离，主流的隔离方案包括 Docker（容器化）、LXC（Linux 容器）、OpenVZ（虚拟机）。</p><p>首先是容器方案，以 Docker 为例。考虑到开销问题，Ubuntu in Docker 首先被排除备选。Docker 有成熟的<a href="https://docs.nvidia.com/datacenter/cloud-native/container-toolkit/latest/install-guide.html#container-runtimes" target="_blank" rel="noopener noreferrer">NVIDIA-Docker</a>支持，可以允许不同容器之间共享 GPU，Docker 成熟的网络接口也使容器的可访问性得到了保障，同时可以使用 Linux 内核的<a href="https://manpages.ubuntu.com/manpages/focal/en/man7/cgroups.7.html" target="_blank" rel="noopener noreferrer">cgroups</a>灵活分配硬件资源，是一个不错的备选方案。</p><p>OpenVZ、KVM、Xen 等虚拟机方案在资源利用上不够轻量，管理上相较 Docker 也复杂很多，同样基于开销问题将其排除备选。</p><p>LXC 可以理解为内核级的容器，允许不同容器之间共享 GPU，相比 Docker 更加轻量，也可以更方便地使用系统资源。</p><p>Docker 的隔离更偏向于运行环境的隔离，将应用和全部依赖环境全部打包到一个单一对象中，可以在不包含完整的操作系统的情况下运行应用，而 LXC 基于 namespaces 进行隔离，可以用<strong>更低的开销</strong>提供灵活的系统环境，支持用户在系统层面肆意整活，这给了我充足的理由选择 LXC。<strong>甚至</strong>用户可以在 LXC 容器中再套娃一个 Docker，既然如此，也没什么好纠结的了。</p><blockquote><p><strong>什么？你问 LXD？</strong></p></blockquote><blockquote><p>那只是我用原生 LXC 觉得太麻烦，并且解决了 LXC 支持跨主机容器迁移不完全、容器管理复杂等问题的备胎，不提也罢（×）。 by yuany3721</p></blockquote><br><details class="hint-container details"><summary>如果您对 LXC 与 LXD 的区别感兴趣，您可以展开这里了解一些信息</summary><p>就在本次部署的两周前，LXD 于 2023 年 6 月 4 日正式移交给 Canonical，<a href="https://linuxcontainers.org/lxd/#project-announcement">公告</a>中展示了这一动作的具体变化。</p><p>就使用体验而言，LXD 无疑是远超 LXC 的，尽管它们似乎（可能就是）用的同一种实现方式和内核。</p><p>以下是一些功能在使用上的区别，也正是复杂性的问题，使我放弃了直接使用 LXC 的想法，转而由 LXD 实现本次部署。</p><table><thead><tr><th>功能</th><th>LXC</th><th>LXD</th></tr></thead><tbody><tr><td>新建容器</td><td><code>lxc-create -t download -n template -- --dist ubuntu --release jammy --arch amd64</code></td><td><code>lxc launch tuna-images:ubuntu/jammy template</code></td></tr><tr><td>启动容器</td><td><code>lxc-start -n template</code></td><td><code>lxc start template</code></td></tr><tr><td>向容器中注入命令</td><td><code>lxc-attach -n template -- apt update</code></td><td><code>lxc exec template -- apt update</code></td></tr><tr><td>修改容器配置</td><td><code>vi path/to/lxc/template/config</code></td><td><code>lxc config edit template</code></td></tr><tr><td>挂载 GPU</td><td><code>for x in $(ls /dev/nvidia\*); do echo lxc.mount.entry = $x $(echo $x | cut -b 2-) none bind,optional,create=file &gt;&gt; path/to/lxc/template/config done</code></td><td><code>lxc config device add template gpu gpu</code></td></tr></tbody></table><p>上述举例如果不能使您窥见一斑，您可以尝试参照<a href="https://linuxcontainers.org/lxc/manpages/">LXC 文档</a>、<a href="https://documentation.ubuntu.com/lxd/en/latest/">LXD 文档</a>进行尝试。</p></details><br><h2 id="环境说明及前置工作" tabindex="-1"><a class="header-anchor" href="#环境说明及前置工作"><span>环境说明及前置工作</span></a></h2><h3 id="环境说明" tabindex="-1"><a class="header-anchor" href="#环境说明"><span><strong>环境说明</strong></span></a></h3><p>本次的物理机硬件环境如下：</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" style="--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212;"><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code><span class="line"><span>CPU: Intel(R) Xeon(R) Platinum 8336C CPU</span></span>
<span class="line"><span>RAM: Samsung DDR4 SingleBitECC 3200 MT/s * 4</span></span>
<span class="line"><span>GPU: NVIDIA GeForce RTX 4090 * 2</span></span>
<span class="line"><span>Disk: Samsung SSD 980 1TB + WUH721816AL 14TB</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>宿主机所在网络环境如下：</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" style="--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212;"><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code><span class="line"><span>gateway: 172.16.60.1/23</span></span>
<span class="line"><span>mask: 255.255.254.0</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="前置工作" tabindex="-1"><a class="header-anchor" href="#前置工作"><span><strong>前置工作</strong></span></a></h3><ol><li>安装 Ubuntu Server</li></ol><p>选择 Ubuntu Server 22.04.2 作为宿主机的系统，使用 rufus 制作系统启动盘后插入服务器，使用 SuperMicroIPMIView 扫描 IPMI 端口，连接 IPMI 服务安装系统，细节省略。</p><p><em>这里其实可以通过网络安装 ubuntu，但是没有折腾，mark 一下以后有机会进行尝试</em></p><ol start="2"><li>配置系统环境</li></ol><p>参考<a class="route-link" href="/note/linux/2023-06-20.html">Ubuntu Server 基本环境配置</a></p><ul><li><p>配置系统联网超时</p></li><li><p>配置 swap 分区</p></li><li><p>配置数据盘挂载</p><p>将<code>WUH721816AL 14TB</code>格式化为<code>/dev/sda1</code>，并挂载在<code>/data</code>目录</p><p>设置 data 目录权限：</p><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" style="--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212;"><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code><span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">$</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> sudo</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> chmod</span><span style="--shiki-light:#2F798A;--shiki-dark:#4C9A91;"> 755</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> /data</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">$</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> sudo</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> chmod</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> +t</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> /data</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p>配置 OpenSSH（可选）</p><p>允许密码登录、修改服务端口为 33</p></li><li><p>配置防火墙</p><p>参考<a class="route-link" href="/note/linux/2021-09-28.html">ufw 防火墙配置</a></p><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" style="--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212;"><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code><span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">$</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> sudo</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> ufw</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> allow</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> 33/tcp</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">$</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> sudo</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> ufw</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> enable</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">$</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> sudo</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> ufw</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> reload</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li></ul><ol start="3"><li>配置网桥</li></ol><p>在类似我们的方案中，<a href="https://abcdabcd987.com/setup-shared-gpu-server-for-labs/" target="_blank" rel="noopener noreferrer">为实验室建立公用 GPU 服务器</a>、<a href="https://github.com/shenuiuin/LXD_GPU_SERVER" target="_blank" rel="noopener noreferrer">实验室 GPU 服务器的 LXD 虚拟化</a>等实操中（不知道为什么）采用了基于 iptables、端口映射的技术实现绕过宿主机访问容器。</p><p><strong>但是！这一点也不优雅！</strong> 服务器就在内网，又不缺 IPv4 地址，为何要加上端口号访问呢？因此，我在宿主机中建立了一个网桥，lxc 容器通过网桥直接从网关 DHCP 获取 IP。</p><p>在 Ubuntu22.04 中，系统默认使用 netplan 配置网络。我们直接以修改 netplan 配置的方式新建一个网桥：</p><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" style="--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212;"><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code><span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">$</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> cd</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> /etc/netplan</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;"># 备份默认配置</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">$</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> sudo</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> cp</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> 00-installer-config.yaml</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> 00-eno1-br0-bridge.yaml</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">$</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> sudo</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> mv</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> 00-installer-config.yaml</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> 00-installer-config.yaml.bak</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">$</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> sudo</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> vi</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> 00-eno1-br0-bridge.yaml</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">network:</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">  renderer:</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> networkd</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">  ethernets:</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">    eno1:</span></span>
<span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;">    # 固定IP</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">      dhcp4:</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> no</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">  bridges:</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">    br0:</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">      interfaces:</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> [eno1]</span></span>
<span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;">      # 这是修改网桥之前eno1网卡获取到的ip，保持一致可以避免一些麻烦</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">      addresses:</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> [172.16.61.82/23]</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">      routes:</span></span>
<span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;">        # 配置默认网关，gateway4已经被标记为deprecated不建议使用</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">        -</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> to:</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> default</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">          via:</span><span style="--shiki-light:#2F798A;--shiki-dark:#4C9A91;"> 172.16.60.1</span></span>
<span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;">          # 加上权重，不进行配置的话产生冲突，使用route命令查看路由表会看到eno1和br0两条default路由，导致无法联网</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">          metric:</span><span style="--shiki-light:#2F798A;--shiki-dark:#4C9A91;"> 100</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">      nameservers:</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">        addresses:</span></span>
<span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;">        # DNS服务器，edit as you like</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">          -</span><span style="--shiki-light:#2F798A;--shiki-dark:#4C9A91;"> 114.114.114.114</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">          -</span><span style="--shiki-light:#2F798A;--shiki-dark:#4C9A91;"> 8.8.8.8</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">          -</span><span style="--shiki-light:#2F798A;--shiki-dark:#4C9A91;"> 8.8.4.4</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">  version:</span><span style="--shiki-light:#2F798A;--shiki-dark:#4C9A91;"> 2</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;"># 应用网络</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">$</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> sudo</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> netplan</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> try</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>检查网络配置，<code>ip a</code>类似这样：</p><blockquote><p>2: eno1: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc mq master br0 state UP group default qlen 1000<br> link/ether 3c:ec:ef:cc:60:28 brd ff:ff:ff:ff:ff:ff<br> altname enp6s0<br> 5: br0: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc noqueue state UP group default qlen 1000<br> link/ether d6:87:d1:44:19:7c brd ff:ff:ff:ff:ff:ff<br> inet 172.16.61.82/23 brd 172.16.61.255 scope global br0<br> valid_lft forever preferred_lft forever<br> inet6 fe80::d487:d1ff:fe44:197c/64 scope link<br> valid_lft forever preferred_lft forever</p></blockquote><p><code>route</code>类似这样：</p><blockquote><p>Kernel IP routing table<br> Destination     Gateway         Genmask         Flags Metric Ref    Use Iface<br> default            _gateway        0.0.0.0              UG    100     0        0     br0<br> 172.16.60.0     0.0.0.0            255.255.254.0   U       0        0        0     br0</p></blockquote><h2 id="配置-lxd-gpu-环境" tabindex="-1"><a class="header-anchor" href="#配置-lxd-gpu-环境"><span>配置 LXD-GPU 环境</span></a></h2><h3 id="配置运行环境" tabindex="-1"><a class="header-anchor" href="#配置运行环境"><span><strong>配置运行环境</strong></span></a></h3><ol><li>安装 LXC、LXD</li></ol><p>这里的 LXD 使用<code>5.0/stable</code>版本，请使用前先查阅<a href="https://documentation.ubuntu.com/lxd/en/latest/installing/#how-to-install-lxd" target="_blank" rel="noopener noreferrer">LXD 官方安装指引</a>修改安装版本号。</p><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" style="--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212;"><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code><span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">$</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> sudo</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> apt</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> update</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">$</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> sudo</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> apt</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> install</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> lxc</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">$</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> sudo</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> snap</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> instll</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> lxd</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> --channel=5.0/stable</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>如果需要的话，可能有必要进行<a class="route-link" href="/note/linux/2023-01-10.html">apt 换源</a></p><p>由于 snap 只有 server outside the Great Firewall，所以提示<code>Unable to contact snap store</code>的时候，可能需要一点点科学上网手段，以下是临时设置 snap 代理的方法：</p><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" style="--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212;"><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code><span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">$</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> sudo</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> snap</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> set</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> system</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> proxy.http=</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">your proxy url</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">$</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> sudo</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> snap</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> set</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> system</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> proxy.https=</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">your proxy url</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><ol start="2"><li>检查 lxc 的依赖</li></ol><p>使用<code>lxc-checkconfig</code>检查 lxc 容器的必要组件。具体到本次配置，该命令显示系统存在以下问题：</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" style="--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212;"><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code><span class="line"><span>Cgroup v1 systemd controller: missing</span></span>
<span class="line"><span>Cgroup v1 freezer controller: missing</span></span>
<span class="line"><span>Cgroup ns_cgroup: required</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>在 Ubuntu22.04 中，默认情况下不会启用 cgroup v1 systemd controller 和 ns_cgroup。编辑<code>/etc/default/grub</code>：</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" style="--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212;"><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code><span class="line"><span>GRUB_CMDLINE_LINUX=&quot;cgroup_enable=memory systemd.unified_cgroup_hierarchy=0 cgroup_namespace.enable=1&quot;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>保存并退出后，更新 GRUB 配置并重新启动系统以应用修改。</p><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" style="--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212;"><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code><span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">$</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> sudo</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> update-grub</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">$</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> sudo</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> reboot</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><ol start="3"><li>配置防火墙以适应网桥</li></ol><p>在 Ubuntu22.04（大概率以及未来的版本）中，ufw 改变了它的默认规则，需要修改网桥的 route 属性，否则会导致 lxc 容器无法从外部网关获取 IP，即使正确地配置了 daemon、dhcp 等所有服务。参考<a href="https://discuss.linuxcontainers.org/t/ubuntu-22-04-lxd-networking-issue-not-getting-ips-and-solution-please-verify-correctness/14739" target="_blank" rel="noopener noreferrer">Ubuntu 22.04 LXD networking issue, not getting IPs, and solution</a></p><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" style="--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212;"><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code><span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">$</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> sudo</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> ufw</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> allow</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> out</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> on</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> br0</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">$</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> sudo</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> ufw</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> route</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> allow</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> out</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> on</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> br0</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="配置基础镜像" tabindex="-1"><a class="header-anchor" href="#配置基础镜像"><span><strong>配置基础镜像</strong></span></a></h3><p><em>注：以下配置过程中，<code>$</code>开头表示命令在宿主机中运行，<code>root@template:~#</code>开头表示命令在 template 容器中以 root 身份（exec 进去的）运行。</em></p><ol><li>初始化 LXD 环境</li></ol><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" style="--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212;"><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code><span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">$</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> lxd</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> init</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>以下是我的配置选项，仅供参考：</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" style="--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212;"><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code><span class="line"><span>Would you like to use LXD clustering? (yes/no) [default=no]: no</span></span>
<span class="line"><span>Do you want to configure a new storage pool? (yes/no) [default=yes]:</span></span>
<span class="line"><span>Name of the new storage pool [default=default]: lxd-pool</span></span>
<span class="line"><span>Name of the storage backend to use (cephobject, dir, lvm, zfs, btrfs, ceph) [default=zfs]:</span></span>
<span class="line"><span>Create a new ZFS pool? (yes/no) [default=yes]:</span></span>
<span class="line"><span>Would you like to use an existing empty block device (e.g. a disk or partition)? (yes/no) [default=no]:</span></span>
<span class="line"><span>Size in GiB of the new loop device (1GiB minimum) [default=30GiB]: 50GiB</span></span>
<span class="line"><span>Would you like to connect to a MAAS server? (yes/no) [default=no]:</span></span>
<span class="line"><span>Would you like to create a new local network bridge? (yes/no) [default=yes]: no</span></span>
<span class="line"><span>Would you like to configure LXD to use an existing bridge or host interface? (yes/no) [default=no]: yes</span></span>
<span class="line"><span>Name of the existing bridge or host interface: br0</span></span>
<span class="line"><span>Would you like the LXD server to be available over the network? (yes/no) [default=no]:</span></span>
<span class="line"><span>Would you like stale cached images to be updated automatically? (yes/no) [default=yes]:</span></span>
<span class="line"><span>Would you like a YAML &quot;lxd init&quot; preseed to be printed? (yes/no) [default=no]: yes</span></span>
<span class="line"><span>config: {}</span></span>
<span class="line"><span>networks: []</span></span>
<span class="line"><span>storage_pools:</span></span>
<span class="line"><span>- config:</span></span>
<span class="line"><span>    size: 50GiB</span></span>
<span class="line"><span>  description: &quot;&quot;</span></span>
<span class="line"><span>  name: lxd-pool</span></span>
<span class="line"><span>  driver: zfs</span></span>
<span class="line"><span>profiles:</span></span>
<span class="line"><span>- config: {}</span></span>
<span class="line"><span>  description: &quot;&quot;</span></span>
<span class="line"><span>  devices:</span></span>
<span class="line"><span>    eth0:</span></span>
<span class="line"><span>      name: eth0</span></span>
<span class="line"><span>      nictype: bridged</span></span>
<span class="line"><span>      parent: br0</span></span>
<span class="line"><span>      type: nic</span></span>
<span class="line"><span>    root:</span></span>
<span class="line"><span>      path: /</span></span>
<span class="line"><span>      pool: lxd-pool</span></span>
<span class="line"><span>      type: disk</span></span>
<span class="line"><span>  name: default</span></span>
<span class="line"><span>projects: []</span></span>
<span class="line"><span>cluster: null</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>修改默认配置文件，限制默认存储大小，避免一个容器占满硬盘</p><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" style="--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212;"><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code><span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">$</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> lxc</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> profile</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> edit</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> default</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">config:</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> {}</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">description:</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> Default</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> LXD</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> profile</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">devices:</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">  eth0:</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">    name:</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> eth0</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">    nictype:</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> bridged</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">    parent:</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> br0</span></span>
<span class="line"><span style="--shiki-light:#998418;--shiki-dark:#B8A965;">    type</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">:</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> nic</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">  root:</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">    path:</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> /</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">    pool:</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> lxd-pool</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">    size:</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> 50GB</span></span>
<span class="line"><span style="--shiki-light:#998418;--shiki-dark:#B8A965;">    type</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">:</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> disk</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">name:</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> default</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">used_by:</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> []</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ol start="2"><li>创建基础容器模板</li></ol><p>添加清华 LXC 镜像，创建<code>template</code>容器模板</p><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" style="--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212;"><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code><span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">$</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> lxc</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> remote</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> add</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> tuna-images</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> https://mirrors.tuna.tsinghua.edu.cn/lxc-images/</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> --protocol=simplestreams</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> --public</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">$</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> lxc</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> launch</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> tuna-images:ubuntu/jammy</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> template</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">Creating</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> template</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">Starting</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> template</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>配置基本环境</p><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" style="--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212;"><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code><span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;"># 进入容器</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">$</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> lxc</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> exec</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> template</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> bash</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;"># 修改默认用户的密码</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">root@template:~#</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> passwd</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> ubuntu</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">yourpassword</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;"># 修改时区</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">root@template:~#</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> timedatectl</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> set-timezone</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> Asia/Shanghai</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;"># 修改apt源</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">root@template:~#</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> cp</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> /etc/apt/sources.list</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> /etc/apt/sources.list.bak</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">root@template:~#</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> vi</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> /etc/apt/sources.list</span></span>
<span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;"># 注释掉源码部分加快apt update速度</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">deb</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> https://mirrors.ustc.edu.cn/ubuntu/</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> jammy</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> main</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> restricted</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> universe</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> multiverse</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">deb</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> https://mirrors.ustc.edu.cn/ubuntu/</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> jammy-updates</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> main</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> restricted</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> universe</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> multiverse</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">deb</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> https://mirrors.ustc.edu.cn/ubuntu/</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> jammy-backports</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> main</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> restricted</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> universe</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> multiverse</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">deb</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> https://mirrors.ustc.edu.cn/ubuntu/</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> jammy-security</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> main</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> restricted</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> universe</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> multiverse</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">deb</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> https://mirrors.ustc.edu.cn/ubuntu/</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> jammy-proposed</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> main</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> restricted</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> universe</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> multiverse</span></span>
<span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;"># deb-src https://mirrors.ustc.edu.cn/ubuntu/ jammy main restricted universe multiverse</span></span>
<span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;"># deb-src https://mirrors.ustc.edu.cn/ubuntu/ jammy-updates main restricted universe multiverse</span></span>
<span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;"># deb-src https://mirrors.ustc.edu.cn/ubuntu/ jammy-backports main restricted universe multiverse</span></span>
<span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;"># deb-src https://mirrors.ustc.edu.cn/ubuntu/ jammy-security main restricted universe multiverse</span></span>
<span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;"># deb-src https://mirrors.ustc.edu.cn/ubuntu/ jammy-proposed main restricted universe multiverse</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">root@template:~#</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> apt</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> update</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">root@template:~#</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> apt</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> upgrade</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> -y</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;"># 安装ssh server</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">root@template:~#</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> apt</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> install</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> -y</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> openssh-server</span></span>
<span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;"># 安装必要软件</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">root@template:~#</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> apt</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> install</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> -y</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> ufw</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> net-tools</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ol start="3"><li>配置 GPU 环境</li></ol><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" style="--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212;"><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code><span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;"># 挂载gpu</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">$</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> lxc</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> config</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> device</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> add</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> ContainerName</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> gpu</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> gpu</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;"># 查看显卡设备文件</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">$</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> ls</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> /dev/nvidia</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;">*</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;"># 安装显卡驱动</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">root@template:~#</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> apt</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> install</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> -y</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> ubuntu-drivers-common</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">root@template:~#</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> ubuntu-drivers</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> devices</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">root@template:~#</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> ubuntu-drivers</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> autoinstall</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">root@template:~#</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> nvidia-smi</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;"># 禁用自动更新(23.08.11update)</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">root@template:~#</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> apt-mark</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> hold</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> *</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">nvidia</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;">*</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">root@template:~#</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> apt-mark</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> showhold</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;"># 显卡驱动版本</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">dpkg</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> -l</span><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;"> |</span><span style="--shiki-light:#59873A;--shiki-dark:#80A665;"> grep</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> nvidia</span></span>
<span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;"># NVRM版本</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">cat</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> /proc/driver/nvidia/version</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>出现类似以下界面说明显卡驱动配置成功。</p><figure><img src="/assets/nvsmi-BmbEDRqC.png" alt="nvsmi" tabindex="0" loading="lazy" width="902" height="501"><figcaption>nvsmi</figcaption></figure><ol start="4"><li>发布<code>template</code>作为基础容器模板</li></ol><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" style="--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212;"><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code><span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">$</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> lxc</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> stop</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> template</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">$</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> lxc</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> publish</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> template</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> --alias</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> template</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> --public</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><ol start="5"><li>基于<code>template</code>建立带桌面环境的容器模板</li></ol><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" style="--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212;"><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code><span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">$</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> lxc</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> launch</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> template</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> template-gnome</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">$</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> lxc</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> exec</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> template-gnome</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;"># 安装gnome桌面</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">root@template-gnome:~#</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> apt</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> install</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> --no-install-recommends</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> -y</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> ubuntu-desktop</span></span>
<span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;"># 安装xrdp远程</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">root@template-gnome:~#</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> apt</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> install</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> -y</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> xrdp</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">root@template-gnome:~#</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> systemctl</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> enable</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> xrdp</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>发布<code>template-gnome</code></p><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" style="--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212;"><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code><span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">$</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> lxc</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> stop</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> template-gnome</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">$</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> lxc</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> publish</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> template-gnome</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> --alias</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> template-gnome</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> --public</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>至此，本次服务器的环境部署就完成了，以下为管理员与用户的使用说明。</strong></p><h2 id="管理员指北" tabindex="-1"><a class="header-anchor" href="#管理员指北"><span>管理员指北</span></a></h2><p><strong>注意：</strong> 宿主机的权限对您是完全开放的，如果您需要在宿主机中执行任何本节之外的命令，请您执行前务必完全明确您的操作会带来什么后果。</p><h3 id="如何访问宿主机" tabindex="-1"><a class="header-anchor" href="#如何访问宿主机"><span><strong>如何访问宿主机</strong></span></a></h3><p>您有两种连接宿主机的方式：</p><ol><li><p>使用 ssh 工具访问<strong>宿主机 IP 的 33 端口</strong>，并使用<strong>用户名</strong>和<strong>密码</strong>进行认证；</p></li><li><p>在浏览器中访问<strong>宿主机的 IPMI 端口 IP</strong>，并使用<strong>IPMI 用户名</strong>和<strong>IPMI 密码</strong>进行认证，进入“远程控制”选项卡，启动控制台。</p></li></ol><p>这两种方法的区别在于，ssh 访问的是 Ubuntu 系统，您只能在系统级别对宿主机进行控制，使用 IPMI 访问则可以获得宿主机包括 BIOS、硬件在内的完全控制。<strong>如非必要，不建议访问 IPMI 端口进行管理</strong></p><h3 id="新建容器" tabindex="-1"><a class="header-anchor" href="#新建容器"><span><strong>新建容器</strong></span></a></h3><p>当前已经配置好了<code>template</code>、<code>template-gnome</code>、<code>template-docker</code>三种容器模板，分别代表最基础的命令行容器、带 gnome 桌面和 xrdp 远程的容器、带 docker 环境的命令行容器，推荐用户使用<code>template</code>进行操作。</p><p>以用户提供的容器名为<code>yuany3721</code>为例，以下操作可以为该用户新建一个容器：</p><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" style="--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212;"><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code><span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;"># 新建容器</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">$</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> lxc</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> launch</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> template-docker</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> yuany3721</span></span>
<span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;"># 挂载GPU</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">$</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> lxc</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> config</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> device</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> add</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> yuany3721</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> gpu</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> gpu</span></span>
<span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;"># 挂载硬盘</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">$</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> sudo</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> mkdir</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> /data/yuany3721/</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">$</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> sudo</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> chown</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> -R</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> 1000:1000</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> /data/yuany3721</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">$</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> lxc</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> config</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> device</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> add</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> yuany3721</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> data</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> disk</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> source=/data/yuany3721/</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> path=/data/</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">$</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> lxc</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> config</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> device</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> add</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> yuany3721</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> sdata</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> disk</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> source=/data/share/</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> path=/sdata/</span></span>
<span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;"># 查看容器详情</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">$</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> lxc</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> list</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>然后将查看到的容器 IP（eth0）告知用户，用户即可使用<code>ssh ubuntu@container-IP</code>访问容器。</p><p>如果用户需要在容器中使用 docker，需要额外修改容器配置如下：</p><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" style="--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212;"><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code><span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">$</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> lxc</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> config</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> set</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> yuany3721</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> security.nesting</span><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;"> true</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">$</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> lxc</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> config</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> set</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> yuany3721</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> security.privileged</span><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;"> true</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">$</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> lxc</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> restart</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> yuany3721</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="删除容器" tabindex="-1"><a class="header-anchor" href="#删除容器"><span><strong>删除容器</strong></span></a></h3><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" style="--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212;"><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code><span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">$</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> lxc</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> stop</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> delcontainer</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">$</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> lxc</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> delete</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> delcontainer</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="用户指南" tabindex="-1"><a class="header-anchor" href="#用户指南"><span>用户指南</span></a></h2><h3 id="联系管理员获取授权" tabindex="-1"><a class="header-anchor" href="#联系管理员获取授权"><span><strong>联系管理员获取授权</strong></span></a></h3><p>您需要告知管理员的信息包括：您的用户名、您是否需要图形界面（推荐无图形界面，性能更好）、您是否希望使用 docker</p><p>管理员会告知您一个 IP，您可以通过该 IP 访问服务器，身份认证的账号为<code>ubuntu</code>，密码为<code>123456</code>。</p><p><strong>注意：</strong> 访问服务器的账号与您的用户名<strong>无关</strong> ；您在获取授权后请尽快访问服务器并<strong>修改密码</strong></p><p>默认情况下，数据卷将被挂载于<code>/data</code>（用户目录）和<code>/sdata</code>（共享目录），共享目录的<code>/sdata/model</code>中有常用模型文件。</p><h3 id="从命令行访问服务器并修改密码" tabindex="-1"><a class="header-anchor" href="#从命令行访问服务器并修改密码"><span><strong>从命令行访问服务器并修改密码</strong></span></a></h3><p>Ubuntu 在输入密码时不会显示输入内容，请不要惊慌，正常输入完毕回车即可。</p><p>以 Windows 系统为例，<kbd>Win+R</kbd>打开<code>cmd</code>，输入命令<code>ssh ubuntu@您的IP</code>，访问服务器。</p><p>提示以下信息时，输入 yes 回车，然后输入默认密码<code>123456</code></p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" style="--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212;"><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code><span class="line"><span>The authenticity of host &#39;172.16.61.xx (172.16.61.xx)&#39; can&#39;t be established.</span></span>
<span class="line"><span>xxxx key fingerprint is SHA256:xxxxxxxxxxxxxxxxxxxxxxx/s.</span></span>
<span class="line"><span>Are you sure you want to continue connecting (yes/no/[fingerprint])?</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><figure><img src="/assets/connect2lxc-DhYgla5D.png" alt="connect2lxc" tabindex="0" loading="lazy" width="747" height="341"><figcaption>connect2lxc</figcaption></figure><p>在新出现的命令行中输入<code>passwd ubuntu</code>修改密码，修改成功后就可以使用新的密码登录服务器了。</p><figure><img src="/assets/passwd-C986yhN_.png" alt="passwd" tabindex="0" loading="lazy" width="367" height="140"><figcaption>passwd</figcaption></figure><h3 id="通过-xrdp-登录图形界面" tabindex="-1"><a class="header-anchor" href="#通过-xrdp-登录图形界面"><span><strong>通过 xrdp 登录图形界面</strong></span></a></h3><p>在 Windows 下，可以使用系统自带的 RDP 软件，<kbd>Win+R</kbd>打开<code>mstsc</code>，输入管理员给您的 IP，点击连接（若出现提示称无法验证远程计算机身份，忽略提示并点击“是”继续连接）。</p><figure><img src="/assets/winRDP-YWnvivdW.png" alt="winRDP" tabindex="0" loading="lazy" width="489" height="328"><figcaption>winRDP</figcaption></figure><p>连接后出现以下界面，在界面中输入账号<code>ubuntu</code>，密码为默认密码或您修改过的密码，点击“OK”，如果信息无误，则可以正常连接到服务器。</p><figure><img src="/assets/xrdp-BYVxSXBc.png" alt="xrdp" tabindex="0" loading="lazy" width="359" height="437"><figcaption>xrdp</figcaption></figure><p>如果您不是 Windows 机器，Linux 可安装 remmina 访问，Mac 可安装 Microsoft Remote Desktop 访问，操作类似，在此不再赘述。</p><p>该连接方式的优点是可以获得完整的 Linux 桌面体验，但当网络环境不佳时操作延时特别大、桌面长时间运行可能会卡死。</p><h3 id="文件传输" tabindex="-1"><a class="header-anchor" href="#文件传输"><span><strong>文件传输</strong></span></a></h3><p>系统配置了一个端口为 22 的 sftp 服务器，您可以使用 Filezilla 等 ftp 工具连接并使用 ftp 进行文件传输。</p><p>当然，您也可以通过远程桌面进行文件拖放，或者使用 ssh 进行文件传输，任何可以与 Linux 实体机器进行网络文件传输的工具都可以在该服务器上使用。</p><h3 id="其它服务器使用方式" tabindex="-1"><a class="header-anchor" href="#其它服务器使用方式"><span><strong>其它服务器使用方式</strong></span></a></h3><p>这里列举几种推荐的使用方式，不同方式的使用场景各不相同，请您在了解各方式的优劣之后，结合自己的需求进行选择：</p><ol><li><p>使用 MobaXterm 进行连接，该方法可以在没有桌面环境的情况下，转发单个应用的图形界面。例如您可以选择一个高性能的命令行界面，安装 Pycharm 之后在远程机器上使用图形化的 Pycharm 界面。</p></li><li><p>使用 vscode 的 remote-ssh 插件远程连接，该方法可以省去 ftp 服务器，直接打开远程服务器中的工程，并进行文件的上传下载和修改、程序的修改和运行。</p></li><li><p>直接使用 powershell 等工具 ssh 远程连接。</p></li></ol><h2 id="参考资料" tabindex="-1"><a class="header-anchor" href="#参考资料"><span>参考资料</span></a></h2><ol><li><a href="https://abcdabcd987.com/setup-shared-gpu-server-for-labs/" target="_blank" rel="noopener noreferrer">为实验室建立公用 GPU 服务器</a></li><li><a href="https://github.com/shenuiuin/LXD_GPU_SERVER" target="_blank" rel="noopener noreferrer">实验室 GPU 服务器的 LXD 虚拟化</a></li><li><a href="https://wiki.openvz.org/Main_Page" target="_blank" rel="noopener noreferrer">OpenVZ</a></li><li><a href="https://linuxcontainers.org/" target="_blank" rel="noopener noreferrer">LXC</a></li><li><a href="https://ubuntu.com/lxd" target="_blank" rel="noopener noreferrer">LXD</a></li><li><a href="https://docker.com" target="_blank" rel="noopener noreferrer">Docker</a></li><li><a href="https://docs.nvidia.com/datacenter/cloud-native/container-toolkit/latest/install-guide.html" target="_blank" rel="noopener noreferrer">NVIDIA container toolkit install guide</a></li><li><a href="https://discuss.linuxcontainers.org/t/ubuntu-22-04-lxd-networking-issue-not-getting-ips-and-solution-please-verify-correctness/14739" target="_blank" rel="noopener noreferrer">LXD networking issue</a></li><li><a href="https://askubuntu.com/questions/1406329/how-to-run-cgexec-without-sudo-as-current-user-on-ubuntu-22-04-with-cgroups-v2" target="_blank" rel="noopener noreferrer">Change cgroup enabled</a></li><li><a href="https://storware.eu/blog/xen-vs-kvm-comparison-of-hypervisors/" target="_blank" rel="noopener noreferrer">Xen vs. KVM – Comparison of Hypervisors</a></li><li><a href="https://www.supermicro.com/en/solutions/management-software/bmc-resources" target="_blank" rel="noopener noreferrer">Supermicro Intelligent Management</a></li><li><a href="https://fabianlee.org/2022/09/20/kvm-creating-a-bridged-network-with-netplan-on-ubuntu-22-04/" target="_blank" rel="noopener noreferrer">KVM: Creating a bridged network</a></li></ol></div><!----><!----><!----></div></main><!----><!----><!--[--><!--]--></div></div></div><!--[--><!--]--></div></div><!--]--><button style="display:none;" type="button" class="vp-back-to-top" aria-label="back to top" data-v-68cd6b44 data-v-f098172b><span class="percent" data-allow-mismatch data-v-f098172b>0%</span><span class="show icon vpi-back-to-top" data-v-f098172b></span><svg aria-hidden="true" data-v-f098172b><circle cx="50%" cy="50%" data-allow-mismatch style="stroke-dasharray:calc(0% - 12.566370614359172px) calc(314.1592653589793% - 12.566370614359172px);" data-v-f098172b></circle></svg></button><footer class="vp-footer" vp-footer data-v-68cd6b44 data-v-400675cf><!--[--><div class="container" data-v-400675cf><p class="message" data-v-400675cf>Power by <a target="_blank" href="https://v2.vuepress.vuejs.org/">VuePress</a> & <a target="_blank" href="https://theme-plume.vuejs.press">vuepress-theme-plume</a></p><p class="copyright" data-v-400675cf>yuany3721</p></div><!--]--></footer><!--[--><!--]--><!--]--></div><!----><!--]--><!--[--><!--]--><!--]--></div><script type="module" src="/assets/app-B5m6HLX-.js" defer></script></body></html>