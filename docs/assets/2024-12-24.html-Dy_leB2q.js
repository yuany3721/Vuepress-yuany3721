import{_ as i,c as a,a as n,o as e}from"./app-B5m6HLX-.js";const l={};function t(h,s){return e(),a("div",null,s[0]||(s[0]=[n(`<div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" style="--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212;"><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code><span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;"># 查看容器硬盘空间</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">df</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> -h</span></span>
<span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;"># 类似于 lxd-pool/containers/container_name   36G   35G  1.9G</span></span>
<span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;"># 在宿主机中查看zfs存储池信息</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">lxc</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> storage</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> list</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">lxc</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> storage</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> info</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> lxc-zfs-pool-name</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>如果是 zfs 空间不足，则扩容 zfs：</p><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" style="--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212;"><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code><span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">sudo</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> zpool</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> set</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> autoexpand=on</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> lxc-zfs-pool-name</span></span>
<span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;"># 扩容存储池文件</span></span>
<span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;"># 如果是apt安装，ZFS存储文件通常位于/var/lib/lxd/disks/default.img；如果是snap安装，则位于/var/snap/lxd/common/lxd/disks/default.img。</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">sudo</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> truncate</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> -s</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> +20G</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> /var/lib/lxd/disks/default.img</span></span>
<span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;"># 重启lxd</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">sudo</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> service</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> lxd</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> restart</span><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;"> # apt安装</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">sudo</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> systemctl</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> restart</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> snap.lxd.daemon</span><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;"> # snap安装</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>如果是容器配额不足（zfs 有空间，容器空间满了），修改容器配额：</p><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" style="--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212;"><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code><span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;"># 查看容器配额</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">zfs</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> get</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> quota</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> lxc-zfs-pool-name/containers/container-name</span></span>
<span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;"># 增加容器配额</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">zfs</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> set</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> quota=newsize</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">(</span><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">例如80G</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">)</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> lxc-zfs-pool-name/containers/container-name</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>不需要重启容器，实时生效</p>`,6)]))}const d=i(l,[["render",t]]),p=JSON.parse('{"path":"/%E9%9A%8F%E8%AE%B0/Linux/2024-12-24.html","title":"使用zfs存储池的lxc容器扩容","lang":"zh-CN","frontmatter":{"title":"使用zfs存储池的lxc容器扩容","createTime":"2024/12/24 08:59:05","tags":["ubuntu"],"categories":["随记"]},"headers":[],"readingTime":{"minutes":0.7,"words":211},"git":{},"filePathRelative":"随记/Linux/2024-12-24.md","categoryList":[{"id":"0f870d","sort":10000,"name":"随记"},{"id":"d513be","sort":10017,"name":"Linux"}]}');export{d as comp,p as data};
