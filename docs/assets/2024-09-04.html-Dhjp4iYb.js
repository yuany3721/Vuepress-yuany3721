import{_ as i,c as n,a as s,o as a}from"./app-YaGH6_b-.js";const t={};function u(l,e){return a(),n("div",null,e[0]||(e[0]=[s(`<h2 id="背景" tabindex="-1"><a class="header-anchor" href="#背景"><span>背景</span></a></h2><p>前段时间 Ubuntu22.4 自动更新内核后，nvidia 535.86 安装不上了，编译报错<code>ERROR: modpost: GPL-incompatible module nvidia.ko uses GPL-only symbol &#39;rcu_read_unlock_strict&#39;</code></p><p>大概有这么个公告：</p><blockquote><p><strong>Problem with 535 Nvidia drivers and 5.15.0-106 kernel</strong> Recently, an ubuntu update to the 5.15.0-106 kernel produced the following error from the nvidia driver when it compiled the kernel module:</p><p>ERROR: modpost: GPL-incompatible module nvidia.ko uses GPL-only symbol &#39;rcu_read_unlock_strict&#39;</p><p>We typically freeze our driver updates so that we can do them at planned downtimes – the fix was to unhold the held nvidia-driver packages and upgrade to nvidia-driver-550</p></blockquote><p>在 forum 上也确定了确实是内核更新带来的 bug，所以简单粗暴回退内核更新尝试解决</p><h2 id="回退-kernel" tabindex="-1"><a class="header-anchor" href="#回退-kernel"><span>回退 kernel</span></a></h2><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" style="--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212;"><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code><span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;"># 查看当前内核版本</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">uname</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> -a</span></span>
<span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;"># 查看grub可选内核版本</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">grep</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> menuentry</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> /boot/grub/grub.cfg</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>输出类似下面这样：</p><blockquote><p>if [ x&quot;\${feature_menuentry_id}&quot; = xy ]; then menuentry_id_option=&quot;--id&quot; menuentry_id_option=&quot;&quot; export menuentry_id_option menuentry &#39;Ubuntu&#39; --class ubuntu --class gnu-linux --class gnu --class os $menuentry_id_option &#39;gnulinux-simple-cdc0eb43-b3e9-4337-b245-bb62aeb7cff5&#39; { submenu &#39;Advanced options for Ubuntu&#39; $menuentry_id_option &#39;gnulinux-advanced-cdc0eb43-b3e9-4337-b245-bb62aeb7cff5&#39; { menuentry &#39;Ubuntu, with Linux 5.15.0-119-generic&#39; --class ubuntu --class gnu-linux --class gnu --class os $menuentry_id_option &#39;gnulinux-5.15.0-119-generic-advanced-cdc0eb43-b3e9-4337-b245-bb62aeb7cff5&#39; { menuentry &#39;Ubuntu, with Linux 5.15.0-119-generic (recovery mode)&#39; --class ubuntu --class gnu-linux --class gnu --class os $menuentry_id_option &#39;gnulinux-5.15.0-119-generic-recovery-cdc0eb43-b3e9-4337-b245-bb62aeb7cff5&#39; { menuentry &#39;Ubuntu, with Linux 5.15.0-105-generic&#39; --class ubuntu --class gnu-linux --class gnu --class os $menuentry_id_option &#39;gnulinux-5.15.0-105-generic-advanced-cdc0eb43-b3e9-4337-b245-bb62aeb7cff5&#39; { menuentry &#39;Ubuntu, with Linux 5.15.0-105-generic (recovery mode)&#39; --class ubuntu --class gnu-linux --class gnu --class os $menuentry_id_option &#39;gnulinux-5.15.0-105-generic-recovery-cdc0eb43-b3e9-4337-b245-bb62aeb7cff5&#39; { menuentry &#39;Ubuntu, with Linux 5.15.0-84-generic&#39; --class ubuntu --class gnu-linux --class gnu --class os $menuentry_id_option &#39;gnulinux-5.15.0-84-generic-advanced-cdc0eb43-b3e9-4337-b245-bb62aeb7cff5&#39; { menuentry &#39;Ubuntu, with Linux 5.15.0-84-generic (recovery mode)&#39; --class ubuntu --class gnu-linux --class gnu --class os $menuentry_id_option &#39;gnulinux-5.15.0-84-generic-recovery-cdc0eb43-b3e9-4337-b245-bb62aeb7cff5&#39; { menuentry &#39;Ubuntu, with Linux 5.15.0-78-generic&#39; --class ubuntu --class gnu-linux --class gnu --class os $menuentry_id_option &#39;gnulinux-5.15.0-78-generic-advanced-cdc0eb43-b3e9-4337-b245-bb62aeb7cff5&#39; { menuentry &#39;Ubuntu, with Linux 5.15.0-78-generic (recovery mode)&#39; --class ubuntu --class gnu-linux --class gnu --class os $menuentry_id_option &#39;gnulinux-5.15.0-78-generic-recovery-cdc0eb43-b3e9-4337-b245-bb62aeb7cff5&#39; { menuentry &#39;UEFI Firmware Settings&#39; $menuentry_id_option &#39;uefi-firmware&#39; {</p></blockquote><p>说明可选内核版本有<code>Ubuntu, with Linux 5.15.0-119-generic</code>、<code>Ubuntu, with Linux 5.15.0-105-generic</code>、<code>Ubuntu, with Linux 5.15.0-84-generic</code>、<code>Ubuntu, with Linux 5.15.0-78-generic</code></p><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" style="--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212;"><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code><span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;"># 查看nvidia驱动版本匹配</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">ls</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> /var/lib/dkms/nvidia/</span></span>
<span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;"># 修改GRUB文件</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">sudo</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> vi</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> /etc/default/grub</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>修改<code>GRUB_DEFAULT=0</code>的<code>0</code>值为<code>&quot;Advanced options for Ubuntu&gt;合适的内核版本&quot;</code></p><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" style="--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212;"><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code><span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;"># 更新grub</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">sudo</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> update-grub</span></span>
<span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;"># 重启</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">sudo</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> reboot</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div>`,13)]))}const d=i(t,[["render",u]]),c=JSON.parse('{"path":"/%E9%9A%8F%E8%AE%B0/Linux/2024-09-04.html","title":"回退Ubuntu Linux kernel","lang":"zh-CN","frontmatter":{"title":"回退Ubuntu Linux kernel","createTime":"2024/09/04 17:57:37","tags":["ubuntu"],"categories":["随记"]},"headers":[],"git":{"updatedTime":1742715324000,"contributors":[{"name":"yuany3721","username":"yuany3721","email":"li1116@mail.ustc.edu.cn","commits":1,"avatar":"https://avatars.githubusercontent.com/yuany3721?v=4","url":"https://github.com/yuany3721"}]},"filePathRelative":"随记/Linux/2024-09-04.md","categoryList":[{"id":"0f870d","sort":10010,"name":"随记"},{"id":"d513be","sort":10012,"name":"Linux"}]}');export{d as comp,c as data};
