import{_ as e,c as i,a,o as n}from"./app-B5m6HLX-.js";const l={};function t(d,s){return n(),i("div",null,s[0]||(s[0]=[a(`<blockquote><p>作者：一见 参考<a href="https://www.cnblogs.com/aquester/p/9891584.html" target="_blank" rel="noopener noreferrer">https://www.cnblogs.com/aquester/p/9891584.html</a></p></blockquote><p>除非明确说明，本文内容仅针对 x86/x86_64 的 Linux 开发环境，有朋友说 baidu 不到，开个贴记录一下（加粗字体是关键词）：</p><p>用<code>-Wl,-Bstatic</code>指定链接静态库，使用<code>-Wl,-Bdynamic</code>指定链接共享库，使用示例：</p><p><code>-Wl,-Bstatic -lmysqlclient_r -lssl -lcrypto -Wl,-Bdynamic -lrt -Wl,-Bdynamic -pthread -Wl,-Bstatic -lgtest</code></p><p>（&quot;-Wl&quot;表示是传递给链接器 ld 的参数，而不是编译器 gcc/g++的参数。）</p><ol><li>下面是因为没有指定链接参数<code>-lz</code>（<code>/usr/lib/libz.so</code>，<code>/usr/lib/libz.a</code> ）</li></ol><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" style="--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212;"><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code><span class="line"><span>/usr/local/mysql/lib/mysql/libmysqlclient.a(my_compress.c.o): In function \`my_uncompress&#39;:</span></span>
<span class="line"><span>/home/software/mysql-5.5.24/mysys/my_compress.c:122: undefined reference to \`uncompress&#39;</span></span>
<span class="line"><span>/usr/local/mysql/lib/mysql/libmysqlclient.a(my_compress.c.o): In function \`my_compress_alloc&#39;:</span></span>
<span class="line"><span>/home/software/mysql-5.5.24/mysys/my_compress.c:71: undefined reference to \`compress&#39;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ol start="2"><li>下面是因为没有指定编译链接参数<code>-pthread</code>（注意不仅仅是<code>-lpthraed</code>）</li></ol><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" style="--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212;"><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code><span class="line"><span>/usr/local/mysql/lib/mysql/libmysqlclient.a(charset.c.o): In function \`get_charset_name&#39;:</span></span>
<span class="line"><span>/home/zhangsan/mysql-5.5.24/mysys/charset.c:533: undefined reference to \`pthread_once&#39;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><ol start="3"><li>下面这个是因为没有指定链接参数<code>-lrt</code></li></ol><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" style="--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212;"><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code><span class="line"><span>/usr/local/thirdparty/curl/lib/libcurl.a(libcurl_la-timeval.o): In function \`curlx_tvnow&#39;:</span></span>
<span class="line"><span>timeval.c:(.text+0xe9): undefined reference to \`clock_gettime&#39;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><ol start="4"><li>下面这个是因为没有指定链接参数<code>-ldl</code></li></ol><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" style="--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212;"><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code><span class="line"><span>/usr/local/thirdparty/openssl/lib/libcrypto.a(dso_dlfcn.o): In function \`dlfcn_globallookup&#39;:</span></span>
<span class="line"><span>dso_dlfcn.c:(.text+0x4c): undefined reference to \`dlopen&#39;</span></span>
<span class="line"><span>dso_dlfcn.c:(.text+0x62): undefined reference to \`dlsym&#39;</span></span>
<span class="line"><span>dso_dlfcn.c:(.text+0x6c): undefined reference to \`dlclose&#39;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ol start="5"><li>下面这个是因为指定了链接参数<code>-static</code>，它的存在，要求链接的必须是静态库，而不能是共享库</li></ol><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" style="--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212;"><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code><span class="line"><span>ld: attempted static link of dynamic object</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>如果是以<code>-L</code>加<code>-l</code>方式指定，则目录下必须有<code>.a</code>文件存在，否则会报<code>-l</code>的库文件找不到：<code>ld: cannot find -lACE</code></p><ol start="6"><li>GCC 编译遇到如下的错误，可能是因为在编译时没有指定<code>-fPIC</code>，记住：<code>-fPIC</code>即是编译参数，也是链接参数</li></ol><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" style="--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212;"><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code><span class="line"><span>relocation R_x86_64_32S against \`vtable for CMyClass\` can not be used when making a shared object</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><ol start="7"><li>下面的错误表示 gcc 编译时需要定义宏<code>__STDC_FORMAT_MACROS</code>，并且必须包含头文件<code>inttypes.h</code></li></ol><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" style="--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212;"><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code><span class="line"><span>test.cpp:35: error: expected \`)&#39; before &#39;PRIu64&#39;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><ol start="8"><li>下面是因为在 x86 机器（32 位）上编译没有指定编译参数<code>-march=pentium4</code></li></ol><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" style="--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212;"><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code><span class="line"><span>../../src/common/libmooon.a(logger.o): In function \`atomic_dec_and_test&#39;:</span></span>
<span class="line"><span>../../include/mooon/sys/atomic_gcc.h:103: undefined reference to \`__sync_sub_and_fetch_4&#39;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><ol start="9"><li>下列错误可能是因为多了个<code>}</code></li></ol><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" style="--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212;"><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code><span class="line"><span>error: expected declaration before &#39;}&#39; token</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><ol start="10"><li>下列错误可能是因为少了个<code>}</code></li></ol><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" style="--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212;"><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code><span class="line"><span>error: expected \`}&#39; at end of input</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><ol start="11"><li>下面这个错误是编译一个共享库时，该共享库依赖的一静态库编译时没有加<code>-fPIC</code>参数，解决方法为带<code>-fPIC</code>重新编译被依赖的静态库</li></ol><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" style="--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212;"><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code><span class="line"><span>relocation R_X86_64_32 against \`a local symbol&#39; can not be used when making a shared object; recompile with -fPIC</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><ol start="12"><li>下面这个错误，是因为头文件中使用<code>_syscall0(pid_t, gettid)</code>不当引起的</li></ol><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" style="--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212;"><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code><span class="line"><span>./test.o: In function \`gettid()&#39;:</span></span>
<span class="line"><span>./test.h:17: multiple definition of \`gettid()&#39;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><p>正确的用法是使用&quot;inline&quot;或&quot;static inline&quot;修饰一下：</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" style="--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212;"><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code><span class="line"><span>inline _syscall0(pid_t, gettid)</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>或</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" style="--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212;"><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code><span class="line"><span>static inline _syscall0(pid_t, gettid)</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>当然也可以这样： 在.h 头文件中：<code>extern &quot;C&quot; pid_t gettid(void);</code> 在.cpp 文件中：<code>_syscall0(pid_t, gettid)</code></p><p>_syscall0 是一个宏，定义一个函数的实现。</p><ol start="13"><li>下列编译告警是因为一个 static 类型的函数未被使用</li></ol><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" style="--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212;"><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code><span class="line"><span>my.cpp:364: warning: &#39;int my_function(const cgicc::Cgicc&amp;, const std::string&amp;)&#39; defined but not used</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>只需使用<code>__attribute__((unused))</code>修饰函数的声明即可：</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" style="--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212;"><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code><span class="line"><span>static int __attribute__((unused)) my_function(const cgicc::Cgicc&amp;, const std::string&amp;);</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><ol start="14"><li>执行 thrift 的 configure 时遇到如下的错误（thrift-0.9.0 和 thrift-0.9.1 遇到过）：</li></ol><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" style="--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212;"><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code><span class="line"><span>checking for setsockopt in -lsocket... no</span></span>
<span class="line"><span>checking for BN_init in -lcrypto... no</span></span>
<span class="line"><span>configure: error: &quot;Error: libcrypto required.&quot;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>原因可能是因为编译安装 openssl 时指定了<code>--prefix</code>，比如<code>--prefix=/usr/local/thirdparty/openssl</code>，可这样解决： 不指定<code>thrift</code>的<code>configure</code>的<code>--with-openssl=/usr/local/thirdparty/openssl</code>，改为：</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" style="--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212;"><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code><span class="line"><span>CPPFLAGS=&quot;-I/usr/local/thirdparty/openssl/include&quot; LDFLAGS=&quot;-ldl -L/usr/local/thirdparty/openssl/lib&quot;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>替代它就 OK 了。</p><ol start="15"><li>下面这个编译错误（表现为 g++进入死循环），可能是由于缺少右大括号<code>}</code>导致的，比如定义名字空间时少了<code>}</code>：</li></ol><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" style="--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212;"><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code><span class="line"><span>/usr/include/c++/4.1.2/tr1/type_traits:408: error: &#39;size_t&#39; is not a member of &#39;db_proxy::std&#39;</span></span>
<span class="line"><span>/usr/include/c++/4.1.2/tr1/type_traits:408: error: &#39;size_t&#39; is not a member of &#39;db_proxy::std&#39;</span></span>
<span class="line"><span>/usr/include/c++/4.1.2/tr1/mu_iterate.h:49: error: &#39;std::tr1&#39; has not been declared</span></span>
<span class="line"><span>/usr/include/c++/4.1.2/tr1/mu_iterate.h:49: error: &#39;std::tr1&#39; has not been declared</span></span>
<span class="line"><span>/usr/include/c++/4.1.2/tr1/bind_iterate.h:78: error: &#39;std::tr1&#39; has not been declared</span></span>
<span class="line"><span>/usr/include/c++/4.1.2/tr1/bind_iterate.h:78: error: &#39;std::tr1&#39; has not been declared</span></span>
<span class="line"><span>/usr/include/c++/4.1.2/tr1/bind_iterate.h:78: error: &#39;std::tr1&#39; has not been declared</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ol start="16"><li>protoc 编译错误，下面错误是因为没有在.proto 文件所在目录下执行：</li></ol><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" style="--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212;"><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code><span class="line"><span>/tmp/test.proto: File does not reside within any path specified using --proto_path (or -I).  You must specify a --proto_path which encompasses this file.  Note that the proto_path must be an exact prefix of the .proto file names -- protoc is too dumb to figure out when two paths (e.g. absolute and relative) are equivalent (it&#39;s harder than you think).</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>解决办法有两个：一是在.proto 文件所在目录下执行 protoc，二是为 protoc 指定参数--proto_path，参数值为.proto 文件所在目录。</p><ol start="17"><li>下面这个编译错误，可能是因为在全局域内调用一个类对象的成员函数，全局域内是不能直接执行函的：</li></ol><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" style="--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212;"><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code><span class="line"><span>error: expected constructor, destructor, or type conversion before &#39;-&gt;&#39; token</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><ol start="18"><li>下面这个错误是因为没有链接 OpenSSL 的 libcrypto 库，或者使用了静态库，而顺序不对：</li></ol><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" style="--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212;"><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code><span class="line"><span>undefined symbol: EVP_enc_null</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><ol start="19"><li>下列是链接错误，不是编译错误，加上<code>-pthread</code>即可，注意不是<code>-lpthread</code>：</li></ol><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" style="--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212;"><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code><span class="line"><span>/usr/local/mysql/lib/mysql/libmysqlclient.a(charset.c.o): In function \`get_charset_name&#39;:</span></span>
<span class="line"><span>/home/software/mysql-5.5.24/mysys/charset.c:533: undefined reference to \`pthread_once&#39;</span></span>
<span class="line"><span>/usr/local/mysql/lib/mysql/libmysqlclient.a(charset.c.o): In function \`get_charset_number&#39;:</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ol start="20"><li>依赖 OpenSSL（假设安装在/usr/local/thirdparty/openssl-1.0.2a）时，如果</li></ol><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" style="--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212;"><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code><span class="line"><span>./configure --prefix=/usr/local/thirdparty/libssh2-1.6.0 --with-libssl-prefix=/usr/local/thirdparty/openssl-1.0.2a</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>时遇到如下错误：</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" style="--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212;"><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code><span class="line"><span>configure: error: No crypto library found!</span></span>
<span class="line"><span>Try --with-libssl-prefix=PATH</span></span>
<span class="line"><span> or --with-libgcrypt-prefix=PATH</span></span>
<span class="line"><span> or --with-wincng on Windows</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>可以如下方法解决：</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" style="--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212;"><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code><span class="line"><span>./configure --prefix=/usr/local/thirdparty/libssh2-1.6.0 --with-openssl CPPFLAGS=&quot;-I/usr/local/thirdparty/openssl-1.0.2a/include&quot; LDFLAGS=&quot;-L/usr/local/thirdparty/openssl-1.0.2a/lib&quot;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><ol start="21"><li>错误<code>error: expected primary-expression before ‘;’ token</code>可能是因为如下原因：</li></ol><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" style="--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212;"><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code><span class="line"><span>UserInfoInternal* user_info_internal = new UserInfoInternal;</span></span>
<span class="line"><span>delete user_info; // 这里应当是user_info_internal</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><ol start="22"><li>下面这个编译错误的原因是定义字符串宏时没有加双引引号：</li></ol><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" style="--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212;"><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code><span class="line"><span>example.cpp:563:16: error: too many decimal points in number</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>如定义成了：<code>#define IP1 127.0.0.1</code>，改成<code>#define IP1 &quot;127.0.0.1&quot;</code>后问题即解决。</p><ol start="23"><li>下面这个编译错误是因为 g++命令参数没写对，多了个<code>-</code></li></ol><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" style="--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212;"><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code><span class="line"><span>g++: -E or -x required when input is from standard input</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>如：</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" style="--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212;"><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code><span class="line"><span>CPPFLAGS=-pthread -</span></span>
<span class="line"><span>g++ -g -o $@ $^ $(CPPFLAGS) $(LDFLAGS)</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><ol start="24"><li><code>libjson_7.6.1</code>编译错误：</li></ol><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" style="--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212;"><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code><span class="line"><span>makefile:180: Extraneous text after \`else&#39; directive</span></span>
<span class="line"><span>makefile:183: *** only one \`else&#39; per conditional.  Stop.</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><p>解决办法： 找到 makefile 文件的第 180 行，将<code>else ifeq ($(BUILD_TYPE), debug)</code>，改成两行内嵌方式：</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" style="--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212;"><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code><span class="line"><span># BUILD_TYPE specific settings</span></span>
<span class="line"><span>ifeq ($(BUILD_TYPE), small)</span></span>
<span class="line"><span>    CXXFLAGS     = $(cxxflags_small)</span></span>
<span class="line"><span>else</span></span>
<span class="line"><span>    ifeq ($(BUILD_TYPE), debug) # 不能和else同一行，否则Makefile语法错误，不支持else ifeq</span></span>
<span class="line"><span>        CXXFLAGS     = $(cxxflags_debug)</span></span>
<span class="line"><span>        libname     := $(libname_debug)</span></span>
<span class="line"><span>    else</span></span>
<span class="line"><span>        CXXFLAGS    ?= $(cxxflags_default)</span></span>
<span class="line"><span>    endif</span></span>
<span class="line"><span>endif</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>可以通过设置环境变量来设置<code>BUILD_TYPE</code>，如：<code>export BUILD_TYPE=debug</code> 也可以通过环境变量来设置<code>make install</code>时的安装目录，如：<code>export prefix=/usr/local/libjson</code></p><p>相关小知识： 在 Makefile 文件中，<code>prefix=/usr</code>和<code>prefix?=/usr</code>，是有区别的，前者赋值不能通过环境变量覆盖，后者则可以使用环境变量的值覆盖。</p><p>另外，请将第 271 行删除：</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" style="--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212;"><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code><span class="line"><span>cp -rv $(srcdir)/Dependencies/ $(include_path)/$(libname_hdr)/$(srcdir)</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>改成：</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" style="--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212;"><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code><span class="line"><span>cp -rv _internal/Dependencies/ $(include_path)/$(libname_hdr)/$(srcdir)</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>还有第 258 行前插入如一条命令：</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" style="--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212;"><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code><span class="line"><span>mkdir -p $(inst_path)</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>否则<code>cp -f ./$(lib_target) $(inst_path)</code>，lib 将成库文件名。</p><ol start="25"><li>编译 gcc 时，如果遇到下面这个错误，这是因为运行时找不到 mpc、mpfr 和 gmp 的 so 文件：</li></ol><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" style="--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212;"><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code><span class="line"><span>checking for x86_64-unknown-linux-gnu-nm... /data/gcc-4.8.2_src/host-x86_64-unknown-linux-gnu/gcc/nm</span></span>
<span class="line"><span>checking for x86_64-unknown-linux-gnu-ranlib... ranlib</span></span>
<span class="line"><span>checking for x86_64-unknown-linux-gnu-strip... strip</span></span>
<span class="line"><span>checking whether ln -s works... yes</span></span>
<span class="line"><span>checking for x86_64-unknown-linux-gnu-gcc... /data/gcc-4.8.2_src/host-x86_64-unknown-linux-gnu/gcc/xgcc -B/data/gcc-4.8.2_src/host-x86_64-unknown-linux-gnu/gcc/ -B/data/gcc-4.8.2/x86_64-unknown-linux-gnu/bin/ -B/data/gcc-4.8.2/x86_64-unknown-linux-gnu/lib/ -isystem /data/gcc-4.8.2/x86_64-unknown-linux-gnu/include -isystem /data/gcc-4.8.2/x86_64-unknown-linux-gnu/sys-include</span></span>
<span class="line"><span>checking for suffix of object files... configure: error: in \`/data/gcc-4.8.2_src/x86_64-unknown-linux-gnu/libgcc&#39;:</span></span>
<span class="line"><span>configure: error: cannot compute suffix of object files: cannot compile</span></span>
<span class="line"><span>See \`config.log&#39; for more details.</span></span>
<span class="line"><span>make[2]: *** [configure-stage1-target-libgcc] 错误 1</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>所以只需要如下操作下即可：</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" style="--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212;"><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code><span class="line"><span>export LD_LIBRARY_PATH=/usr/local/mpc/lib:/usr/local/mpfr/lib:/usr/local/gmp/lib:$LD_LIBRARY_PATH</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>注：gcc-4.8.2 依赖 mpc、mpfr 和 gmp：</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" style="--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212;"><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code><span class="line"><span>./configure --prefix=/usr/local/gcc-4.8.2 --with-mpc=/usr/local/mpc-1.0.3 --with-mpfr=/usr/local/mpfr-3.1.3 --with-gmp=/usr/local/gmp-6.0.0</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>而 mpc 又依赖于：mpfr 和 gmp：</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" style="--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212;"><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code><span class="line"><span>./configure --prefix=/usr/local/mpc-1.0.3 --with-mpfr=/usr/local/mpfr-3.1.3 --with-gmp=/usr/local/gmp-6.0.0</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><ol start="26"><li>编译 gcc 时，如果遇到下面这个错误：</li></ol><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" style="--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212;"><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code><span class="line"><span>fatal error: gnu/stubs-32.h: No such file or directory</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>这是因为在 x86_64 上，默认会编译出 32 位和 64 位两个版本。这样编译 32 位时，需要机器上有 32 位的 libc 头文件和库文件，但一些机器上可能没有，比如没有/lib 目录，只有/lib64 目录，这表示不支持 32 位的 libc。为解决这个问题，可以禁止编译 32 位版本，在 configure 时带上参数<code>--disable-multilib</code>，或者安装 32 位版本的 glibc。</p><ol start="27"><li>某次编译遇到如下这样一个链接错误：</li></ol><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" style="--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212;"><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code><span class="line"><span>redis_dbi.cpp:224: undefined reference to \`sdscatlen(char*, void const*, unsigned long)&#39;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>按常理，这个错误要么是没有指定相应的库，要么是静态库间的顺序问题。</p><p>但经过检查，这两个原因，而是因为 gcc 和 g++混用原因：</p><ol><li>库 libhiredis.a 和 libhiredis.so 是由 gcc 编译出来的</li><li>而调用它的代码是由 g++编译的，因此导致了此问题。</li></ol><p>问题的解决办法有两个：</p><ol><li><p>修改 sdscatlen 所在的.h 文件，将代码使用</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" style="--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212;"><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code><span class="line"><span>#ifdef __cplusplus</span></span>
<span class="line"><span>extern &quot;C&quot; {</span></span>
<span class="line"><span>#endif</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>修饰起来，或者直接使用<code>extern C</code>修饰函数 sdscatlen。</p></li><li><p>不修改 redis 的代码，在引用 sds.h 时加上<code>extern &quot;C&quot; {</code>： <code> extern &quot;C&quot; { #include &quot;sds.h&quot; }</code> 上面两个办法均可，当然也可以考虑改用 g++编译 redis，不过可能会遇到很多错误。 redis 对外供外部直接使用的头文件 hiredis.h 已使用了<code>extern &quot;C&quot; {</code>，所以不存在问题，只有当跳过 hiredis.h，去使用一些内部头文件时需要注意一下。</p></li><li></li></ol><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" style="--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212;"><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code><span class="line"><span>x.hpp:27: error: expected identifier before string constant</span></span>
<span class="line"><span>x.hpp:27: error: expected \`}&#39; before string constant</span></span>
<span class="line"><span>x.hpp:27: error: expected unqualified-id before string constant</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>这个错误，可能是存在和枚举等同名的字符串宏，比如存在下面的宏定义：</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" style="--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212;"><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code><span class="line"><span>enum DBTYPE</span></span>
<span class="line"><span>{</span></span>
<span class="line"><span>    UNDEFINE = 0,</span></span>
<span class="line"><span>    MYSQL_DB = 1,</span></span>
<span class="line"><span>    ORACLE_DB = 2</span></span>
<span class="line"><span>};</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>而另一.h 文件中定义了宏： <code>#define MYSQL_DB &quot;mysql&quot;</code></p><ol start="29"><li>下面这个错误是因为类成员函数的声明和定义的返回值不相同</li></ol><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" style="--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212;"><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code><span class="line"><span>test.cpp:201:6: 错误：‘bool foo(const string&amp;, const string&amp;, const string&amp;, const string&amp;, const string&amp;, const HBaseRowValue&amp;)’的原型不匹配类‘CTest’中的任何一个</span></span>
<span class="line"><span> bool CHBaseOper::foo(const std::string&amp; tablename, const std::string&amp; rowkey, const std::string&amp; familyname, const std::string&amp; columnname, const std::string&amp; columnvalue, const HBaseRowValue&amp; row_values)</span></span>
<span class="line"><span>      ^</span></span>
<span class="line"><span>In file included from test.cpp:8:0:</span></span>
<span class="line"><span>test.h:58:6: 错误：备选为：int foo(const string&amp;, const string&amp;, const string&amp;, const string&amp;, const string&amp;, const HBaseRowValue&amp;)</span></span>
<span class="line"><span>  int foo(const std::string&amp; tablename, const std::string&amp; rowkey, const std::string&amp; familyname, const std::string&amp; columnname, const std::string&amp; columnvalue, const HBaseRowValue&amp; row_values);</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ol start="30"><li><code>messenger.cpp:5: error: expected unqualified-id before &#39;:&#39; token</code> 该编译错误原因是：</li></ol><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" style="--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212;"><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code><span class="line"><span>CMessager:CMessager()</span></span>
<span class="line"><span>{</span></span>
<span class="line"><span>}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>即少了个冒号：</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" style="--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212;"><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code><span class="line"><span>CMessager::CMessager()</span></span>
<span class="line"><span>{</span></span>
<span class="line"><span>}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ol start="31"><li><p><code>unable to find a register to spill in class ‘SIREG’</code> 编译时如果遇到这个错误，表示遇到一个 gcc 的 bug，最简单的办法是去掉编译参数中的-O3 等优化项，然后再试可能就成功了，也可以考虑指定<code>-fno-schedule-insns</code>。</p></li><li><p>像下面这样一大堆乱七八糟的错误，可以考虑是否为少了<code>}</code>等引起的</p></li></ol><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" style="--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212;"><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code><span class="line"><span>/usr/include/c++/4.8.2/bits/stl_list.h:131:15: 错误：‘bidirectional_iterator_tag’不是命名空间‘tom::std’中的一个类型名</span></span>
<span class="line"><span>       typedef std::bidirectional_iterator_tag    iterator_category;</span></span>
<span class="line"><span>               ^</span></span>
<span class="line"><span>/usr/include/c++/4.8.2/bits/stl_list.h: 在成员函数‘_Tp* tom::std::_List_iterator&lt;_tp&gt;::operator-&gt;() const’中:</span></span>
<span class="line"><span>/usr/include/c++/4.8.2/bits/stl_list.h:150:16: 错误：‘__addressof’不是‘tom::std’的成员</span></span>
<span class="line"><span>       { return std::__addressof(static_cast&lt;_Node*&gt;(_M_node)-&gt;_M_data); }</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>比如：</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" style="--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212;"><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code><span class="line"><span>namespace A { namespace B {</span></span>
<span class="line"><span>    。。。。。。</span></span>
<span class="line"><span>// 下面少了一个\`}\`</span></span>
<span class="line"><span>} // namespace A { namespace B {</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ol start="33"><li><code>crc32’ cannot be used as a function</code></li></ol><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" style="--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212;"><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code><span class="line"><span>uint32_t crc32 = crc32(0L, (const unsigned char*)crc32_str.data(), crc32_str.size());</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>错误是因为函数名和变量名相同了，可以改成如下解决：</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" style="--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212;"><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code><span class="line"><span>uint32_t crc32 = ::crc32(0L, (const unsigned char*)crc32_str.data(), crc32_str.size());</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><ol start="34"><li></li></ol><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" style="--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212;"><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code><span class="line"><span>/data/X/mooon/tools/hbase_stress.cpp: In function &#39;void test_write(const std::map&lt;std::basic_string&lt;char&gt;, std::basic_string&lt;char&gt; &gt;&amp;)&#39;:</span></span>
<span class="line"><span>/data/X/mooon/tools/hbase_stress.cpp:78:117: error: invalid conversion from &#39;void (*)(uint8_t, const string&amp;, uint16_t) {aka void (*)(unsigned char, const std::basic_string&lt;char&gt;&amp;, short unsigned int)}&#39; to &#39;mooon::sys::FunctionWith3Parameter&lt;unsigned char, std::basic_string&lt;char&gt;, short unsigned int&gt;::FunctionPtr {aka void (*)(unsigned char, std::basic_string&lt;char&gt;, short unsigned int)}&#39; [-fpermissive]</span></span>
<span class="line"><span>             stress_threads[i] = new mooon::sys::CThreadEngine(mooon::sys::bind(write_thread, i, hbase_ip, hbase_port));                                                                                                                     ^</span></span>
<span class="line"><span>In file included from /data/X/mooon/tools/hbase_stress.cpp:24:0:</span></span>
<span class="line"><span>/data/X/mooon/tools/../include/mooon/sys/thread_engine.h:777:16: error:   initializing argument 1 of &#39;mooon::sys::Functor mooon::sys::bind(typename mooon::sys::FunctionWith3Parameter&lt;Parameter1Type, Parameter2Type, Parameter3Type&gt;::FunctionPtr, Parameter1Type, Parameter2Type, Parameter3Type) [with Parameter1Type = unsigned char; Parameter2Type = std::basic_string&lt;char&gt;; Parameter3Type = short unsigned int; typename mooon::sys::FunctionWith3Parameter&lt;Parameter1Type, Parameter2Type, Parameter3Type&gt;::FunctionPtr = void (*)(unsigned char, std::basic_string&lt;char&gt;, short unsigned int)]&#39; [-fpermissive]</span></span>
<span class="line"><span> inline Functor bind(typename FunctionWith3Parameter&lt;Parameter1Type, Parameter2Type, Parameter3Type&gt;::FunctionPtr function_ptr, Parameter1Type parameter1, Parameter2Type parameter2, Parameter3Type parameter3)</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>上面这个错误的意思是第一个参数的类型为</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" style="--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212;"><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code><span class="line"><span>void (*)(unsigned char, std::basic_string&lt;char&gt;, short unsigned int)</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>但传入的类型为</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" style="--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212;"><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code><span class="line"><span>void (*)(unsigned char, const std::basic_string&lt;char&gt;&amp;, short unsigned int)</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>从上面的对比可以看出，要求函数的第二个参数为 std::string 类型，而不是 const std::string&amp;类型。</p><ol start="35"><li></li></ol><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" style="--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212;"><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code><span class="line"><span>conflicting declaration</span></span>
<span class="line"><span>has a previous declaration as</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><p>这个错误可能是因为头文件没有<code>#ifndef</code>，导致引入多次。</p><ol start="36"><li></li></ol><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" style="--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212;"><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code><span class="line"><span>warning: cannot pass objects of non-POD type ‘const struct std::basic_string&lt;char, std::char_traits&lt;char&gt;, std::allocator&lt;char&gt; &gt;’ through ‘...’; call will abort at runtime</span></span>
<span class="line"><span>warning: format ‘%s’ expects type ‘char*’, but argument 3 has type ‘int</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><p>这个错误是因为格式化<code>%s</code>参数的值为<code>std::string</code>值，这个在运行时可能会触发<code>SIGILL（Illegal instruction）</code>，例如：</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" style="--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212;"><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code><span class="line"><span>std::string type;</span></span>
<span class="line"><span>std::string name;</span></span>
<span class="line"><span>。。。 。。。</span></span>
<span class="line"><span>const std::string&amp; key = mooon::utils::CStringUtils::format_string(&quot;%s_%s&quot;, type.c_str(), name);</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ol start="37"><li><p><code>&#39;__curl_rule_01__&#39; is negative</code> 这个编译错误，是因为在 64 位平台上编译 64 位程序，但 curl 库是 32 位方式编译的。</p></li><li></li></ol><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" style="--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212;"><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code><span class="line"><span>countable_log_writer.cpp:54:50: 错误：从类型‘const CCounter*’到类型‘CCounter*’的转换无效 [-fpermissive]</span></span>
<span class="line"><span>     return (NULL == counter)? &amp;_default_counter: counter;</span></span>
<span class="line"><span>                                                  ^</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>错误实际出在<code>_default_counter</code>的使用上，返回的是非<code>const</code>类型的<code>CCounter*</code>。 而由于函数<code>get_counter</code>是<code>const</code>类型函数，意味着<code>this</code>也是<code>const</code>类型， <code>&amp;_default_counter</code>也就成了<code>const CCounter*</code>类型。 简单的修改方法是将<code>_default_counter</code>定义成<code>CCounter*</code>指针类型，而非<code>CCounter</code>对象类型。</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" style="--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212;"><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code><span class="line"><span>CCounter* CCountableLogWriter::get_counter(const std::string&amp; type) const</span></span>
<span class="line"><span>{</span></span>
<span class="line"><span>    CCounter* counter = NULL;</span></span>
<span class="line"><span>    CCounterTable::const_iterator iter = _counter_table.find(type);</span></span>
<span class="line"><span></span></span>
<span class="line"><span></span></span>
<span class="line"><span>    if (iter != _counter_table.end())</span></span>
<span class="line"><span>        counter = iter-&gt;second;</span></span>
<span class="line"><span>    return (NULL == counter)? &amp;_default_counter: counter;</span></span>
<span class="line"><span>}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div>`,138)]))}const c=e(l,[["render",t]]),p=JSON.parse('{"path":"/%E9%9A%8F%E8%AE%B0/2021-09-28.html","title":"常见gcc编译问题解决方法集","lang":"zh-CN","frontmatter":{"title":"常见gcc编译问题解决方法集","author":"一见","createTime":"2021/09/28","tags":["gcc","转载"],"categories":["随记"]},"headers":[],"readingTime":{"minutes":10.91,"words":3274},"git":{},"filePathRelative":"随记/2021-09-28.md","categoryList":[{"id":"0f870d","sort":10000,"name":"随记"}]}');export{c as comp,p as data};
