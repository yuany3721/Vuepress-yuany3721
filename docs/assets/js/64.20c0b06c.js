(window.webpackJsonp=window.webpackJsonp||[]).push([[64],{635:function(n,e,s){"use strict";s.r(e);var t=s(17),u=Object(t.a)({},(function(){var n=this,e=n.$createElement,s=n._self._c||e;return s("ContentSlotsDistributor",{attrs:{"slot-key":n.$parent.slotKey}},[s("h2",{attrs:{id:"背景"}},[n._v("背景")]),n._v(" "),s("p",[n._v("前段时间Ubuntu22.4自动更新内核后，nvidia 535.86安装不上了，编译报错"),s("code",[n._v("ERROR: modpost: GPL-incompatible module nvidia.ko uses GPL-only symbol 'rcu_read_unlock_strict'")])]),n._v(" "),s("p",[n._v("大概有这么个公告：")]),n._v(" "),s("blockquote",[s("p",[s("strong",[n._v("Problem with 535 Nvidia drivers and 5.15.0-106 kernel")]),n._v("\nRecently, an ubuntu update to the 5.15.0-106 kernel produced the following error from the nvidia driver when it compiled the kernel module:")]),n._v(" "),s("p",[n._v("ERROR: modpost: GPL-incompatible module nvidia.ko uses GPL-only symbol 'rcu_read_unlock_strict'")]),n._v(" "),s("p",[n._v("We typically freeze our driver updates so that we can do them at planned downtimes – the fix was to unhold the held nvidia-driver packages and upgrade to nvidia-driver-550")])]),n._v(" "),s("p",[n._v("在forum上也确定了确实是内核更新带来的bug，所以简单粗暴回退内核更新尝试解决")]),n._v(" "),s("h2",{attrs:{id:"回退kernel"}},[n._v("回退kernel")]),n._v(" "),s("div",{staticClass:"language-bash line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[n._v("# 查看当前内核版本")]),n._v("\n"),s("span",{pre:!0,attrs:{class:"token function"}},[n._v("uname")]),n._v(" -a\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[n._v("# 查看grub可选内核版本")]),n._v("\n"),s("span",{pre:!0,attrs:{class:"token function"}},[n._v("grep")]),n._v(" menuentry /boot/grub/grub.cfg\n")])]),n._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[n._v("1")]),s("br"),s("span",{staticClass:"line-number"},[n._v("2")]),s("br"),s("span",{staticClass:"line-number"},[n._v("3")]),s("br"),s("span",{staticClass:"line-number"},[n._v("4")]),s("br")])]),s("p",[n._v("输出类似下面这样：")]),n._v(" "),s("blockquote",[s("p",[n._v("if [ x\"${feature_menuentry_id}\" = xy ]; then\nmenuentry_id_option=\"--id\"\nmenuentry_id_option=\"\"\nexport menuentry_id_option\nmenuentry 'Ubuntu' --class ubuntu --class gnu-linux --class gnu --class os $menuentry_id_option 'gnulinux-simple-cdc0eb43-b3e9-4337-b245-bb62aeb7cff5' {\nsubmenu 'Advanced options for Ubuntu' $menuentry_id_option 'gnulinux-advanced-cdc0eb43-b3e9-4337-b245-bb62aeb7cff5' {\nmenuentry 'Ubuntu, with Linux 5.15.0-119-generic' --class ubuntu --class gnu-linux --class gnu --class os $menuentry_id_option 'gnulinux-5.15.0-119-generic-advanced-cdc0eb43-b3e9-4337-b245-bb62aeb7cff5' {\nmenuentry 'Ubuntu, with Linux 5.15.0-119-generic (recovery mode)' --class ubuntu --class gnu-linux --class gnu --class os $menuentry_id_option 'gnulinux-5.15.0-119-generic-recovery-cdc0eb43-b3e9-4337-b245-bb62aeb7cff5' {\nmenuentry 'Ubuntu, with Linux 5.15.0-105-generic' --class ubuntu --class gnu-linux --class gnu --class os $menuentry_id_option 'gnulinux-5.15.0-105-generic-advanced-cdc0eb43-b3e9-4337-b245-bb62aeb7cff5' {\nmenuentry 'Ubuntu, with Linux 5.15.0-105-generic (recovery mode)' --class ubuntu --class gnu-linux --class gnu --class os $menuentry_id_option 'gnulinux-5.15.0-105-generic-recovery-cdc0eb43-b3e9-4337-b245-bb62aeb7cff5' {\nmenuentry 'Ubuntu, with Linux 5.15.0-84-generic' --class ubuntu --class gnu-linux --class gnu --class os $menuentry_id_option 'gnulinux-5.15.0-84-generic-advanced-cdc0eb43-b3e9-4337-b245-bb62aeb7cff5' {\nmenuentry 'Ubuntu, with Linux 5.15.0-84-generic (recovery mode)' --class ubuntu --class gnu-linux --class gnu --class os $menuentry_id_option 'gnulinux-5.15.0-84-generic-recovery-cdc0eb43-b3e9-4337-b245-bb62aeb7cff5' {\nmenuentry 'Ubuntu, with Linux 5.15.0-78-generic' --class ubuntu --class gnu-linux --class gnu --class os $menuentry_id_option 'gnulinux-5.15.0-78-generic-advanced-cdc0eb43-b3e9-4337-b245-bb62aeb7cff5' {\nmenuentry 'Ubuntu, with Linux 5.15.0-78-generic (recovery mode)' --class ubuntu --class gnu-linux --class gnu --class os $menuentry_id_option 'gnulinux-5.15.0-78-generic-recovery-cdc0eb43-b3e9-4337-b245-bb62aeb7cff5' {\nmenuentry 'UEFI Firmware Settings' $menuentry_id_option 'uefi-firmware' {")])]),n._v(" "),s("p",[n._v("说明可选内核版本有"),s("code",[n._v("Ubuntu, with Linux 5.15.0-119-generic")]),n._v("、"),s("code",[n._v("Ubuntu, with Linux 5.15.0-105-generic")]),n._v("、"),s("code",[n._v("Ubuntu, with Linux 5.15.0-84-generic")]),n._v("、"),s("code",[n._v("Ubuntu, with Linux 5.15.0-78-generic")])]),n._v(" "),s("div",{staticClass:"language-bash line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[n._v("# 查看nvidia驱动版本匹配")]),n._v("\n"),s("span",{pre:!0,attrs:{class:"token function"}},[n._v("ls")]),n._v(" /var/lib/dkms/nvidia/\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[n._v("# 修改GRUB文件")]),n._v("\n"),s("span",{pre:!0,attrs:{class:"token function"}},[n._v("sudo")]),n._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[n._v("vi")]),n._v(" /etc/default/grub\n")])]),n._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[n._v("1")]),s("br"),s("span",{staticClass:"line-number"},[n._v("2")]),s("br"),s("span",{staticClass:"line-number"},[n._v("3")]),s("br"),s("span",{staticClass:"line-number"},[n._v("4")]),s("br")])]),s("p",[n._v("修改"),s("code",[n._v("GRUB_DEFAULT=0")]),n._v("的"),s("code",[n._v("0")]),n._v("值为"),s("code",[n._v('"Advanced options for Ubuntu>合适的内核版本"')])]),n._v(" "),s("div",{staticClass:"language-bash line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[n._v("# 更新grub")]),n._v("\n"),s("span",{pre:!0,attrs:{class:"token function"}},[n._v("sudo")]),n._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[n._v("update-grub")]),n._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[n._v("# 重启")]),n._v("\n"),s("span",{pre:!0,attrs:{class:"token function"}},[n._v("sudo")]),n._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[n._v("reboot")]),n._v("\n")])]),n._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[n._v("1")]),s("br"),s("span",{staticClass:"line-number"},[n._v("2")]),s("br"),s("span",{staticClass:"line-number"},[n._v("3")]),s("br"),s("span",{staticClass:"line-number"},[n._v("4")]),s("br")])])])}),[],!1,null,null,null);e.default=u.exports}}]);