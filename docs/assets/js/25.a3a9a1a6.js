(window.webpackJsonp=window.webpackJsonp||[]).push([[25],{593:function(s,e,t){"use strict";t.r(e);var n=t(17),a=Object(n.a)({},(function(){var s=this,e=s.$createElement,t=s._self._c||e;return t("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[t("blockquote",[t("p",[s._v("作者：一见\n参考"),t("a",{attrs:{href:"https://www.cnblogs.com/aquester/p/9891584.html",target:"_blank",rel:"noopener noreferrer"}},[s._v("https://www.cnblogs.com/aquester/p/9891584.html"),t("OutboundLink")],1)])]),s._v(" "),t("p",[s._v("除非明确说明，本文内容仅针对x86/x86_64的Linux开发环境，有朋友说baidu不到，开个贴记录一下（加粗字体是关键词）：")]),s._v(" "),t("p",[s._v("用"),t("code",[s._v("-Wl,-Bstatic")]),s._v("指定链接静态库，使用"),t("code",[s._v("-Wl,-Bdynamic")]),s._v("指定链接共享库，使用示例：")]),s._v(" "),t("p",[t("code",[s._v("-Wl,-Bstatic -lmysqlclient_r -lssl -lcrypto -Wl,-Bdynamic -lrt -Wl,-Bdynamic -pthread -Wl,-Bstatic -lgtest")])]),s._v(" "),t("p",[s._v('（"-Wl"表示是传递给链接器ld的参数，而不是编译器gcc/g++的参数。）')]),s._v(" "),t("ol",[t("li",[s._v("下面是因为没有指定链接参数"),t("code",[s._v("-lz")]),s._v("（"),t("code",[s._v("/usr/lib/libz.so")]),s._v("，"),t("code",[s._v("/usr/lib/libz.a")]),s._v(" ）")])]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("/usr/local/mysql/lib/mysql/libmysqlclient.a(my_compress.c.o): In function `my_uncompress':\n/home/software/mysql-5.5.24/mysys/my_compress.c:122: undefined reference to `uncompress'\n/usr/local/mysql/lib/mysql/libmysqlclient.a(my_compress.c.o): In function `my_compress_alloc':\n/home/software/mysql-5.5.24/mysys/my_compress.c:71: undefined reference to `compress'\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br")])]),t("ol",{attrs:{start:"2"}},[t("li",[s._v("下面是因为没有指定编译链接参数"),t("code",[s._v("-pthread")]),s._v("（注意不仅仅是"),t("code",[s._v("-lpthraed")]),s._v("）")])]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("/usr/local/mysql/lib/mysql/libmysqlclient.a(charset.c.o): In function `get_charset_name':\n/home/zhangsan/mysql-5.5.24/mysys/charset.c:533: undefined reference to `pthread_once'\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br")])]),t("ol",{attrs:{start:"3"}},[t("li",[s._v("下面这个是因为没有指定链接参数"),t("code",[s._v("-lrt")])])]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("/usr/local/thirdparty/curl/lib/libcurl.a(libcurl_la-timeval.o): In function `curlx_tvnow':\ntimeval.c:(.text+0xe9): undefined reference to `clock_gettime'\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br")])]),t("ol",{attrs:{start:"4"}},[t("li",[s._v("下面这个是因为没有指定链接参数"),t("code",[s._v("-ldl")])])]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("/usr/local/thirdparty/openssl/lib/libcrypto.a(dso_dlfcn.o): In function `dlfcn_globallookup':\ndso_dlfcn.c:(.text+0x4c): undefined reference to `dlopen'\ndso_dlfcn.c:(.text+0x62): undefined reference to `dlsym'\ndso_dlfcn.c:(.text+0x6c): undefined reference to `dlclose'\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br")])]),t("ol",{attrs:{start:"5"}},[t("li",[s._v("下面这个是因为指定了链接参数"),t("code",[s._v("-static")]),s._v("，它的存在，要求链接的必须是静态库，而不能是共享库")])]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("ld: attempted static link of dynamic object\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v("如果是以"),t("code",[s._v("-L")]),s._v("加"),t("code",[s._v("-l")]),s._v("方式指定，则目录下必须有"),t("code",[s._v(".a")]),s._v("文件存在，否则会报"),t("code",[s._v("-l")]),s._v("的库文件找不到："),t("code",[s._v("ld: cannot find -lACE")])]),s._v(" "),t("ol",{attrs:{start:"6"}},[t("li",[s._v("GCC编译遇到如下的错误，可能是因为在编译时没有指定"),t("code",[s._v("-fPIC")]),s._v("，记住："),t("code",[s._v("-fPIC")]),s._v("即是编译参数，也是链接参数")])]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("relocation R_x86_64_32S against `vtable for CMyClass` can not be used when making a shared object\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("ol",{attrs:{start:"7"}},[t("li",[s._v("下面的错误表示gcc编译时需要定义宏"),t("code",[s._v("__STDC_FORMAT_MACROS")]),s._v("，并且必须包含头文件"),t("code",[s._v("inttypes.h")])])]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("test.cpp:35: error: expected `)' before 'PRIu64'\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("ol",{attrs:{start:"8"}},[t("li",[s._v("下面是因为在x86机器（32位）上编译没有指定编译参数"),t("code",[s._v("-march=pentium4")])])]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("../../src/common/libmooon.a(logger.o): In function `atomic_dec_and_test':\n../../include/mooon/sys/atomic_gcc.h:103: undefined reference to `__sync_sub_and_fetch_4'\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br")])]),t("ol",{attrs:{start:"9"}},[t("li",[s._v("下列错误可能是因为多了个"),t("code",[s._v("}")])])]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("error: expected declaration before '}' token\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("ol",{attrs:{start:"10"}},[t("li",[s._v("下列错误可能是因为少了个"),t("code",[s._v("}")])])]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("error: expected `}' at end of input\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("ol",{attrs:{start:"11"}},[t("li",[s._v("下面这个错误是编译一个共享库时，该共享库依赖的一静态库编译时没有加"),t("code",[s._v("-fPIC")]),s._v("参数，解决方法为带"),t("code",[s._v("-fPIC")]),s._v("重新编译被依赖的静态库")])]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("relocation R_X86_64_32 against `a local symbol' can not be used when making a shared object; recompile with -fPIC\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("ol",{attrs:{start:"12"}},[t("li",[s._v("下面这个错误，是因为头文件中使用"),t("code",[s._v("_syscall0(pid_t, gettid)")]),s._v("不当引起的")])]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("./test.o: In function `gettid()':\n./test.h:17: multiple definition of `gettid()'\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br")])]),t("p",[s._v('正确的用法是使用"inline"或"static inline"修饰一下：')]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("inline _syscall0(pid_t, gettid)\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v("或")]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("static inline _syscall0(pid_t, gettid)\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v("当然也可以这样：\n在.h头文件中："),t("code",[s._v('extern "C" pid_t gettid(void);')]),s._v("\n在.cpp文件中："),t("code",[s._v("_syscall0(pid_t, gettid)")])]),s._v(" "),t("p",[s._v("_syscall0是一个宏，定义一个函数的实现。")]),s._v(" "),t("ol",{attrs:{start:"13"}},[t("li",[s._v("下列编译告警是因为一个static类型的函数未被使用")])]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("my.cpp:364: warning: 'int my_function(const cgicc::Cgicc&, const std::string&)' defined but not used\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v("只需使用"),t("code",[s._v("__attribute__((unused))")]),s._v("修饰函数的声明即可：")]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("static int __attribute__((unused)) my_function(const cgicc::Cgicc&, const std::string&);\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("ol",{attrs:{start:"14"}},[t("li",[s._v("执行thrift的configure时遇到如下的错误（thrift-0.9.0和thrift-0.9.1遇到过）：")])]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v('checking for setsockopt in -lsocket... no\nchecking for BN_init in -lcrypto... no\nconfigure: error: "Error: libcrypto required."\n')])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br")])]),t("p",[s._v("原因可能是因为编译安装openssl时指定了"),t("code",[s._v("--prefix")]),s._v("，比如"),t("code",[s._v("--prefix=/usr/local/thirdparty/openssl")]),s._v("，可这样解决：\n不指定"),t("code",[s._v("thrift")]),s._v("的"),t("code",[s._v("configure")]),s._v("的"),t("code",[s._v("--with-openssl=/usr/local/thirdparty/openssl")]),s._v("，改为：")]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v('CPPFLAGS="-I/usr/local/thirdparty/openssl/include" LDFLAGS="-ldl -L/usr/local/thirdparty/openssl/lib"\n')])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v("替代它就OK了。")]),s._v(" "),t("ol",{attrs:{start:"15"}},[t("li",[s._v("下面这个编译错误（表现为g++进入死循环），可能是由于缺少右大括号"),t("code",[s._v("}")]),s._v("导致的，比如定义名字空间时少了"),t("code",[s._v("}")]),s._v("：")])]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("/usr/include/c++/4.1.2/tr1/type_traits:408: error: 'size_t' is not a member of 'db_proxy::std'\n/usr/include/c++/4.1.2/tr1/type_traits:408: error: 'size_t' is not a member of 'db_proxy::std'\n/usr/include/c++/4.1.2/tr1/mu_iterate.h:49: error: 'std::tr1' has not been declared\n/usr/include/c++/4.1.2/tr1/mu_iterate.h:49: error: 'std::tr1' has not been declared\n/usr/include/c++/4.1.2/tr1/bind_iterate.h:78: error: 'std::tr1' has not been declared\n/usr/include/c++/4.1.2/tr1/bind_iterate.h:78: error: 'std::tr1' has not been declared\n/usr/include/c++/4.1.2/tr1/bind_iterate.h:78: error: 'std::tr1' has not been declared\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br")])]),t("ol",{attrs:{start:"16"}},[t("li",[s._v("protoc编译错误，下面错误是因为没有在.proto文件所在目录下执行：")])]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("/tmp/test.proto: File does not reside within any path specified using --proto_path (or -I).  You must specify a --proto_path which encompasses this file.  Note that the proto_path must be an exact prefix of the .proto file names -- protoc is too dumb to figure out when two paths (e.g. absolute and relative) are equivalent (it's harder than you think).\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v("解决办法有两个：一是在.proto文件所在目录下执行protoc，二是为protoc指定参数--proto_path，参数值为.proto文件所在目录。")]),s._v(" "),t("ol",{attrs:{start:"17"}},[t("li",[s._v("下面这个编译错误，可能是因为在全局域内调用一个类对象的成员函数，全局域内是不能直接执行函的：")])]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("error: expected constructor, destructor, or type conversion before '->' token\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("ol",{attrs:{start:"18"}},[t("li",[s._v("下面这个错误是因为没有链接OpenSSL的libcrypto库，或者使用了静态库，而顺序不对：")])]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("undefined symbol: EVP_enc_null\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("ol",{attrs:{start:"19"}},[t("li",[s._v("下列是链接错误，不是编译错误，加上"),t("code",[s._v("-pthread")]),s._v("即可，注意不是"),t("code",[s._v("-lpthread")]),s._v("：")])]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("/usr/local/mysql/lib/mysql/libmysqlclient.a(charset.c.o): In function `get_charset_name':\n/home/software/mysql-5.5.24/mysys/charset.c:533: undefined reference to `pthread_once'\n/usr/local/mysql/lib/mysql/libmysqlclient.a(charset.c.o): In function `get_charset_number':\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br")])]),t("ol",{attrs:{start:"20"}},[t("li",[s._v("依赖OpenSSL（假设安装在/usr/local/thirdparty/openssl-1.0.2a）时，如果")])]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("./configure --prefix=/usr/local/thirdparty/libssh2-1.6.0 --with-libssl-prefix=/usr/local/thirdparty/openssl-1.0.2a\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v("时遇到如下错误：")]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("configure: error: No crypto library found!\nTry --with-libssl-prefix=PATH\n or --with-libgcrypt-prefix=PATH\n or --with-wincng on Windows\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br")])]),t("p",[s._v("可以如下方法解决：")]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v('./configure --prefix=/usr/local/thirdparty/libssh2-1.6.0 --with-openssl CPPFLAGS="-I/usr/local/thirdparty/openssl-1.0.2a/include" LDFLAGS="-L/usr/local/thirdparty/openssl-1.0.2a/lib"\n')])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("ol",{attrs:{start:"21"}},[t("li",[s._v("错误"),t("code",[s._v("error: expected primary-expression before ‘;’ token")]),s._v("可能是因为如下原因：")])]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("UserInfoInternal* user_info_internal = new UserInfoInternal;\ndelete user_info; // 这里应当是user_info_internal\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br")])]),t("ol",{attrs:{start:"22"}},[t("li",[s._v("下面这个编译错误的原因是定义字符串宏时没有加双引引号：")])]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("example.cpp:563:16: error: too many decimal points in number\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v("如定义成了："),t("code",[s._v("#define IP1 127.0.0.1")]),s._v("，改成"),t("code",[s._v('#define IP1 "127.0.0.1"')]),s._v("后问题即解决。")]),s._v(" "),t("ol",{attrs:{start:"23"}},[t("li",[s._v("下面这个编译错误是因为g++命令参数没写对，多了个"),t("code",[s._v("-")])])]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("g++: -E or -x required when input is from standard input\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v("如：")]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("CPPFLAGS=-pthread -\ng++ -g -o $@ $^ $(CPPFLAGS) $(LDFLAGS)\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br")])]),t("ol",{attrs:{start:"24"}},[t("li",[t("code",[s._v("libjson_7.6.1")]),s._v("编译错误：")])]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("makefile:180: Extraneous text after `else' directive\nmakefile:183: *** only one `else' per conditional.  Stop.\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br")])]),t("p",[s._v("解决办法：\n找到makefile文件的第180行，将"),t("code",[s._v("else ifeq ($(BUILD_TYPE), debug)")]),s._v("，改成两行内嵌方式：")]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("# BUILD_TYPE specific settings\nifeq ($(BUILD_TYPE), small)\n    CXXFLAGS     = $(cxxflags_small)\nelse\n    ifeq ($(BUILD_TYPE), debug) # 不能和else同一行，否则Makefile语法错误，不支持else ifeq\n        CXXFLAGS     = $(cxxflags_debug)\n        libname     := $(libname_debug)\n    else\n        CXXFLAGS    ?= $(cxxflags_default)\n    endif\nendif\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br")])]),t("p",[s._v("可以通过设置环境变量来设置"),t("code",[s._v("BUILD_TYPE")]),s._v("，如："),t("code",[s._v("export BUILD_TYPE=debug")]),s._v("\n也可以通过环境变量来设置"),t("code",[s._v("make install")]),s._v("时的安装目录，如："),t("code",[s._v("export prefix=/usr/local/libjson")])]),s._v(" "),t("p",[s._v("相关小知识：\n在Makefile文件中，"),t("code",[s._v("prefix=/usr")]),s._v("和"),t("code",[s._v("prefix?=/usr")]),s._v("，是有区别的，前者赋值不能通过环境变量覆盖，后者则可以使用环境变量的值覆盖。")]),s._v(" "),t("p",[s._v("另外，请将第271行删除：")]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("cp -rv $(srcdir)/Dependencies/ $(include_path)/$(libname_hdr)/$(srcdir)\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v("改成：")]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("cp -rv _internal/Dependencies/ $(include_path)/$(libname_hdr)/$(srcdir)\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v("还有第258行前插入如一条命令：")]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("mkdir -p $(inst_path)\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v("否则"),t("code",[s._v("cp -f ./$(lib_target) $(inst_path)")]),s._v("，lib将成库文件名。")]),s._v(" "),t("ol",{attrs:{start:"25"}},[t("li",[s._v("编译gcc时，如果遇到下面这个错误，这是因为运行时找不到mpc、mpfr和gmp的so文件：")])]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("checking for x86_64-unknown-linux-gnu-nm... /data/gcc-4.8.2_src/host-x86_64-unknown-linux-gnu/gcc/nm\nchecking for x86_64-unknown-linux-gnu-ranlib... ranlib\nchecking for x86_64-unknown-linux-gnu-strip... strip\nchecking whether ln -s works... yes\nchecking for x86_64-unknown-linux-gnu-gcc... /data/gcc-4.8.2_src/host-x86_64-unknown-linux-gnu/gcc/xgcc -B/data/gcc-4.8.2_src/host-x86_64-unknown-linux-gnu/gcc/ -B/data/gcc-4.8.2/x86_64-unknown-linux-gnu/bin/ -B/data/gcc-4.8.2/x86_64-unknown-linux-gnu/lib/ -isystem /data/gcc-4.8.2/x86_64-unknown-linux-gnu/include -isystem /data/gcc-4.8.2/x86_64-unknown-linux-gnu/sys-include   \nchecking for suffix of object files... configure: error: in `/data/gcc-4.8.2_src/x86_64-unknown-linux-gnu/libgcc':\nconfigure: error: cannot compute suffix of object files: cannot compile\nSee `config.log' for more details.\nmake[2]: *** [configure-stage1-target-libgcc] 错误 1\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br")])]),t("p",[s._v("所以只需要如下操作下即可：")]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("export LD_LIBRARY_PATH=/usr/local/mpc/lib:/usr/local/mpfr/lib:/usr/local/gmp/lib:$LD_LIBRARY_PATH\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v("注：gcc-4.8.2依赖mpc、mpfr和gmp：")]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("./configure --prefix=/usr/local/gcc-4.8.2 --with-mpc=/usr/local/mpc-1.0.3 --with-mpfr=/usr/local/mpfr-3.1.3 --with-gmp=/usr/local/gmp-6.0.0\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v("而mpc又依赖于：mpfr和gmp：")]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("./configure --prefix=/usr/local/mpc-1.0.3 --with-mpfr=/usr/local/mpfr-3.1.3 --with-gmp=/usr/local/gmp-6.0.0\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("ol",{attrs:{start:"26"}},[t("li",[s._v("编译gcc时，如果遇到下面这个错误：")])]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("fatal error: gnu/stubs-32.h: No such file or directory\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v("这是因为在x86_64上，默认会编译出32位和64位两个版本。这样编译32位时，需要机器上有32位的libc头文件和库文件，但一些机器上可能没有，比如没有/lib目录，只有/lib64目录，这表示不支持32位的libc。为解决这个问题，可以禁止编译32位版本，在configure时带上参数"),t("code",[s._v("--disable-multilib")]),s._v("，或者安装32位版本的glibc。")]),s._v(" "),t("ol",{attrs:{start:"27"}},[t("li",[s._v("某次编译遇到如下这样一个链接错误：")])]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("redis_dbi.cpp:224: undefined reference to `sdscatlen(char*, void const*, unsigned long)'\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v("按常理，这个错误要么是没有指定相应的库，要么是静态库间的顺序问题。")]),s._v(" "),t("p",[s._v("但经过检查，这两个原因，而是因为gcc和g++混用原因：")]),s._v(" "),t("ol",[t("li",[s._v("库libhiredis.a和libhiredis.so是由gcc编译出来的")]),s._v(" "),t("li",[s._v("而调用它的代码是由g++编译的，因此导致了此问题。")])]),s._v(" "),t("p",[s._v("问题的解决办法有两个：")]),s._v(" "),t("ol",[t("li",[t("p",[s._v("修改sdscatlen所在的.h文件，将代码使用")]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v('#ifdef __cplusplus\nextern "C" {\n#endif\n')])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br")])]),t("p",[s._v("修饰起来，或者直接使用"),t("code",[s._v("extern C")]),s._v("修饰函数sdscatlen。")])]),s._v(" "),t("li",[t("p",[s._v("不修改redis的代码，在引用sds.h时加上"),t("code",[s._v('extern "C" {')]),s._v("：")]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v('extern "C" {\n#include "sds.h"\n}\n')])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br")])])])]),s._v(" "),t("p",[s._v("上面两个办法均可，当然也可以考虑改用g++编译redis，不过可能会遇到很多错误。\nredis对外供外部直接使用的头文件hiredis.h已使用了"),t("code",[s._v('extern "C" {')]),s._v("，所以不存在问题，只有当跳过hiredis.h，去使用一些内部头文件时需要注意一下。")]),s._v(" "),t("ol",{attrs:{start:"28"}},[t("li")]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("x.hpp:27: error: expected identifier before string constant\nx.hpp:27: error: expected `}' before string constant\nx.hpp:27: error: expected unqualified-id before string constant\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br")])]),t("p",[s._v("这个错误，可能是存在和枚举等同名的字符串宏，比如存在下面的宏定义：")]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("enum DBTYPE\n{\n    UNDEFINE = 0,\n    MYSQL_DB = 1,\n    ORACLE_DB = 2\n};\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br")])]),t("p",[s._v("而另一.h文件中定义了宏：\n"),t("code",[s._v('#define MYSQL_DB "mysql"')])]),s._v(" "),t("ol",{attrs:{start:"29"}},[t("li",[s._v("下面这个错误是因为类成员函数的声明和定义的返回值不相同")])]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("test.cpp:201:6: 错误：‘bool foo(const string&, const string&, const string&, const string&, const string&, const HBaseRowValue&)’的原型不匹配类‘CTest’中的任何一个\n bool CHBaseOper::foo(const std::string& tablename, const std::string& rowkey, const std::string& familyname, const std::string& columnname, const std::string& columnvalue, const HBaseRowValue& row_values)\n      ^\nIn file included from test.cpp:8:0:\ntest.h:58:6: 错误：备选为：int foo(const string&, const string&, const string&, const string&, const string&, const HBaseRowValue&)\n  int foo(const std::string& tablename, const std::string& rowkey, const std::string& familyname, const std::string& columnname, const std::string& columnvalue, const HBaseRowValue& row_values);\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br")])]),t("ol",{attrs:{start:"30"}},[t("li",[t("code",[s._v("messenger.cpp:5: error: expected unqualified-id before ':' token")]),s._v("\n该编译错误原因是：")])]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("CMessager:CMessager()\n{\n}\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br")])]),t("p",[s._v("即少了个冒号：")]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("CMessager::CMessager()\n{\n}\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br")])]),t("ol",{attrs:{start:"31"}},[t("li",[t("p",[t("code",[s._v("unable to find a register to spill in class ‘SIREG’")]),s._v("\n编译时如果遇到这个错误，表示遇到一个gcc的bug，最简单的办法是去掉编译参数中的-O3等优化项，然后再试可能就成功了，也可以考虑指定"),t("code",[s._v("-fno-schedule-insns")]),s._v("。")])]),s._v(" "),t("li",[t("p",[s._v("像下面这样一大堆乱七八糟的错误，可以考虑是否为少了"),t("code",[s._v("}")]),s._v("等引起的")])])]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("/usr/include/c++/4.8.2/bits/stl_list.h:131:15: 错误：‘bidirectional_iterator_tag’不是命名空间‘tom::std’中的一个类型名\n       typedef std::bidirectional_iterator_tag    iterator_category;\n               ^\n/usr/include/c++/4.8.2/bits/stl_list.h: 在成员函数‘_Tp* tom::std::_List_iterator<_tp>::operator->() const’中:\n/usr/include/c++/4.8.2/bits/stl_list.h:150:16: 错误：‘__addressof’不是‘tom::std’的成员\n       { return std::__addressof(static_cast<_Node*>(_M_node)->_M_data); } \n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br")])]),t("p",[s._v("比如：")]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("namespace A { namespace B {\n    。。。。。。\n// 下面少了一个`}`\n} // namespace A { namespace B {\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br")])]),t("ol",{attrs:{start:"33"}},[t("li",[t("code",[s._v("crc32’ cannot be used as a function")])])]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("uint32_t crc32 = crc32(0L, (const unsigned char*)crc32_str.data(), crc32_str.size());\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v("错误是因为函数名和变量名相同了，可以改成如下解决：")]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("uint32_t crc32 = ::crc32(0L, (const unsigned char*)crc32_str.data(), crc32_str.size());\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("ol",{attrs:{start:"34"}},[t("li")]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("/data/X/mooon/tools/hbase_stress.cpp: In function 'void test_write(const std::map<std::basic_string<char>, std::basic_string<char> >&)':\n/data/X/mooon/tools/hbase_stress.cpp:78:117: error: invalid conversion from 'void (*)(uint8_t, const string&, uint16_t) {aka void (*)(unsigned char, const std::basic_string<char>&, short unsigned int)}' to 'mooon::sys::FunctionWith3Parameter<unsigned char, std::basic_string<char>, short unsigned int>::FunctionPtr {aka void (*)(unsigned char, std::basic_string<char>, short unsigned int)}' [-fpermissive]\n             stress_threads[i] = new mooon::sys::CThreadEngine(mooon::sys::bind(write_thread, i, hbase_ip, hbase_port));                                                                                                                     ^\nIn file included from /data/X/mooon/tools/hbase_stress.cpp:24:0:\n/data/X/mooon/tools/../include/mooon/sys/thread_engine.h:777:16: error:   initializing argument 1 of 'mooon::sys::Functor mooon::sys::bind(typename mooon::sys::FunctionWith3Parameter<Parameter1Type, Parameter2Type, Parameter3Type>::FunctionPtr, Parameter1Type, Parameter2Type, Parameter3Type) [with Parameter1Type = unsigned char; Parameter2Type = std::basic_string<char>; Parameter3Type = short unsigned int; typename mooon::sys::FunctionWith3Parameter<Parameter1Type, Parameter2Type, Parameter3Type>::FunctionPtr = void (*)(unsigned char, std::basic_string<char>, short unsigned int)]' [-fpermissive]\n inline Functor bind(typename FunctionWith3Parameter<Parameter1Type, Parameter2Type, Parameter3Type>::FunctionPtr function_ptr, Parameter1Type parameter1, Parameter2Type parameter2, Parameter3Type parameter3)\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br")])]),t("p",[s._v("上面这个错误的意思是第一个参数的类型为")]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("void (*)(unsigned char, std::basic_string<char>, short unsigned int)\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v("但传入的类型为")]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("void (*)(unsigned char, const std::basic_string<char>&, short unsigned int)\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v("从上面的对比可以看出，要求函数的第二个参数为std::string类型，而不是const std::string&类型。")]),s._v(" "),t("ol",{attrs:{start:"35"}},[t("li")]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("conflicting declaration \nhas a previous declaration as\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br")])]),t("p",[s._v("这个错误可能是因为头文件没有"),t("code",[s._v("#ifndef")]),s._v("，导致引入多次。")]),s._v(" "),t("ol",{attrs:{start:"36"}},[t("li")]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("warning: cannot pass objects of non-POD type ‘const struct std::basic_string<char, std::char_traits<char>, std::allocator<char> >’ through ‘...’; call will abort at runtime\nwarning: format ‘%s’ expects type ‘char*’, but argument 3 has type ‘int\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br")])]),t("p",[s._v("这个错误是因为格式化"),t("code",[s._v("%s")]),s._v("参数的值为"),t("code",[s._v("std::string")]),s._v("值，这个在运行时可能会触发"),t("code",[s._v("SIGILL（Illegal instruction）")]),s._v("，例如：")]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v('std::string type;\nstd::string name;\n。。。 。。。\nconst std::string& key = mooon::utils::CStringUtils::format_string("%s_%s", type.c_str(), name);\n')])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br")])]),t("ol",{attrs:{start:"37"}},[t("li",[t("p",[t("code",[s._v("'__curl_rule_01__' is negative")]),s._v("\n这个编译错误，是因为在64位平台上编译64位程序，但curl库是32位方式编译的。")])]),s._v(" "),t("li")]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("countable_log_writer.cpp:54:50: 错误：从类型‘const CCounter*’到类型‘CCounter*’的转换无效 [-fpermissive]\n     return (NULL == counter)? &_default_counter: counter;\n                                                  ^\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br")])]),t("p",[s._v("错误实际出在"),t("code",[s._v("_default_counter")]),s._v("的使用上，返回的是非"),t("code",[s._v("const")]),s._v("类型的"),t("code",[s._v("CCounter*")]),s._v("。\n而由于函数"),t("code",[s._v("get_counter")]),s._v("是"),t("code",[s._v("const")]),s._v("类型函数，意味着"),t("code",[s._v("this")]),s._v("也是"),t("code",[s._v("const")]),s._v("类型，\n"),t("code",[s._v("&_default_counter")]),s._v("也就成了"),t("code",[s._v("const CCounter*")]),s._v("类型。\n简单的修改方法是将"),t("code",[s._v("_default_counter")]),s._v("定义成"),t("code",[s._v("CCounter*")]),s._v("指针类型，而非"),t("code",[s._v("CCounter")]),s._v("对象类型。")]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("CCounter* CCountableLogWriter::get_counter(const std::string& type) const\n{\n    CCounter* counter = NULL;\n    CCounterTable::const_iterator iter = _counter_table.find(type);\n\n\n    if (iter != _counter_table.end())\n        counter = iter->second;\n    return (NULL == counter)? &_default_counter: counter;\n}\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br")])])])}),[],!1,null,null,null);e.default=a.exports}}]);